<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' unpkg.com www.googletagmanager.com *.google-analytics.com; img-src 'self' data: *;style-src 'self' 'unsafe-inline'">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="canonical" href="https://blog.jermdavis.dev/posts/2019/i-think-i-found-my-reason-not-to-use-vs2019-for-everything">
		<meta name="description" content="I've been using VS2019 for all my personal development work pretty much since the first preview came out. For general coding and debugging it's been good so far – stable, and effective. And little things like git stash control from the UI make me happy... It got its full release recently, just before <a href=&quot;/posts/2019/sugcon-2019-session-slides&quot; target=&quot;_blank&quot;>I spoke at SUGCON 2019</a> – where I said I'd blog something about how 2019 changed the performance measurement stuff that I was presenting. Having done some tests in the last few days, it's not looking so shiny any more...">
		<meta property="og:description" content="I've been using VS2019 for all my personal development work pretty much since the first preview came out. For general coding and debugging it's been good so far – stable, and effective. And little things like git stash control from the UI make me happy... It got its full release recently, just before <a href=&quot;/posts/2019/sugcon-2019-session-slides&quot; target=&quot;_blank&quot;>I spoke at SUGCON 2019</a> – where I said I'd blog something about how 2019 changed the performance measurement stuff that I was presenting. Having done some tests in the last few days, it's not looking so shiny any more...">
		<meta name="keywords" content="Sitecore, Visual Studio">
		<meta name="author" content="Jeremy Davis">
		<meta name="copyright" content="Jeremy Davis">
		<title>Jeremy Davis - I think I found my reason not to use VS2019 for&nbsp;everything..</title>
		<meta name="robots" content="index, follow">
		<link type="application/rss+xml" rel="alternate" title="Jeremy Davis - Sitecore, C# and web development" href="/feed.rss">
		<link type="application/atom+xml" rel="alternate" title="Jeremy Davis - Sitecore, C# and web development" href="/feed.atom">
		<meta name="application-name" content="Jeremy Davis">
		<meta name="msapplication-tooltip" content="Jeremy Davis">
		<meta name="msapplication-starturl" content="/">
		<link rel="manifest" href="/manifest.webmanifest">
		<meta property="og:title" content="Jeremy Davis - I think I found my reason not to use VS2019 for&amp;#xA0;everything..">
		<meta property="og:publish_date" content="2019-04-29T00:00:00+00:00">
		<meta property="og:type" content="article">
		<meta property="og:image" content="https://blog.jermdavis.dev/img/featured/i-think-i-found-my-reason-not-to-use-vs2019-for-everything-social.jpg">
		<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "article",
        "headline": "I think I found my reason not to use VS2019 for&#xA0;everything..",
        "url": "https://blog.jermdavis.dev/posts/2019/i-think-i-found-my-reason-not-to-use-vs2019-for-everything",
        "image": [
            "https://blog.jermdavis.dev/img/featured/i-think-i-found-my-reason-not-to-use-vs2019-for-everything-social.jpg"
        ],
        "datePublished": "2019-04-29T00:00:00+00:00",
        "author": [{
            "@type": "Person",
            "name": "Jeremy Davis",
            "url": "https://jermdavis.dev/"
        }]
    }
    
		</script>
		<meta property="og:url" content="https://blog.jermdavis.dev/posts/2019/i-think-i-found-my-reason-not-to-use-vs2019-for-everything">
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
		<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">
		<link href="/scss/tailwind.css" rel="stylesheet">
		<link href="/vendor/Enlighter/enlighterjs.min.css" rel="stylesheet">
		<link href="/scss/site-theme.css" rel="stylesheet">
		<script src="/vendor/Cookies/cookies.min.js" defer=""></script>
	</head>
	<body class="max-w-7xl mx-auto text-black" id="top">
		<div class="relative bg-white" x-data="{ open: false }">
			
			<!-- desktop -->
			<div class="px-4 lg:px-6 bg-gray-100">
				<div class="bannerContainer flex justify-between items-center border-b-2 border-gray-100 py-6 lg:justify-start lg:space-x-10">
					<div class="flex justify-start lg:w-0 flex-1">
						<a href="/">
							<img class="mt-2" width="56" height="56" src="/img/Profile.jpg" alt="Jeremy Davis">
						</a>
						<div class="mx-2">
							<div class="text-3xl">Jeremy Davis</div>
							<div class="text-lg">Sitecore, C# and web development</div>
						</div>
					</div>
					<div class="nav -mr-2 -my-2 lg:hidden">
						<button @click="open = true" type="button" class="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" aria-expanded="false">
							<span class="sr-only">Open menu</span>
							
							<!-- Heroicon name: outline/menu -->
							<svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
							</svg>
						</button>
					</div>
					<nav class="nav hidden lg:flex space-x-10">
						<a class="text-base font-medium" href="/posts">Posts</a>
						<a class="text-base font-medium" href="/tags">Tags</a>
						<a class="text-base font-medium" href="/about">About</a>
						<a class="text-base font-medium" href="/links">Useful Links</a>
						<a class="text-base font-medium" href="/mvp">MVP</a>
					</nav>
				</div>
			</div>
			
			<!--Mobile menu, show/hide based on mobile menu state.-->
			<div class="absolute top-0 inset-x-0 p-2 transition transform origin-top-right lg:hidden z-50">
				<div class="rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 bg-white divide-y-2 divide-gray-50" x-show="open" x-transition="">
					<div class="pt-5 pb-6 px-5">
						<div class="flex items-center justify-between">
							<div class="flex">
								<a href="/">
									<img class="mt-2" width="56" height="56" src="/img/Profile.jpg" alt="Jeremy Davis">
								</a>
								<div class="mx-2">
									<div class="text-2xl">Jeremy Davis</div>
									<div class="text-base">Sitecore, C# and web development</div>
								</div>
							</div>
							<div class="nav -mr-2">
								<button @click="open = false" type="button" class="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
									<span class="sr-only">Close menu</span>
									
									<!-- Heroicon name: outline/x -->
									<svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
									</svg>
								</button>
							</div>
						</div>
					</div>
					<div class="nav py-6 px-5 pt-0">
						<nav class=" gap-x-8">
							<a class="block mt-5 text-base font-medium" href="/posts">Posts</a>
							<a class="block mt-5 text-base font-medium" href="/tags">Tags</a>
							<a class="block mt-5 text-base font-medium" href="/about">About</a>
							<a class="block mt-5 text-base font-medium" href="/links">Useful Links</a>
							<a class="block mt-5 text-base font-medium" href="/mvp">MVP</a>
						</nav>
					</div>
				</div>
			</div>
		</div>
		<header class="bg-gray-300 px-4 py-1 lg:px-6 text-center" style="">
			<div class="post-heading">
				<div class="url p-1 bg-gray-100 rounded-md">Article printed from:
					<tt>https://blog.jermdavis.dev/posts/2019/i-think-i-found-my-reason-not-to-use-vs2019-for-everything</tt>
				</div>
				<h1 class="text-5xl mb-4 pb-1">
					I think I found my reason not to use VS2019 for&nbsp;everything..
				</h1>
				<div class="meta">Published 29 April 2019</div>
				<div class="flex py-1">
					<a href="/tags/sitecore/" class="p-1 mr-1 bg-gray-100 rounded-md">
						Sitecore</a>
					<a href="/tags/visual-studio/" class="p-1 mr-1 bg-gray-100 rounded-md">
						Visual Studio</a>
				</div>
			</div>
		</header>
		<div class="py-2 lg:pl-3">
			<div class="lg:flex">
				<div class="lg:flex-auto mx-3 lg:min-w-0 content">
					<p>I've been using VS2019 for all my personal development work pretty much since the first preview came out. For general coding and debugging it's been good so far – stable, and effective. And little things like git stash control from the UI make me happy... It got its full release recently, just before
						<a href="/posts/2019/sugcon-2019-session-slides" target="_blank">I spoke at SUGCON 2019</a>
						– where I said I'd blog something about how 2019 changed the performance measurement stuff that I was presenting. Having done some tests in the last few days, it's not looking so shiny any more...
						<!--more-->
					</p>
					<h2>So what changed?</h2>
					<p>Well initially it looks like mostly UI changes. The "Performance Session" UI that I showed in my presentation isn't there any more. You now select "Debug / Performance Profiler" to open a "Diagnostic Tools" window:</p>
					<p>
						<a href="/img/2019/2019-01-performancemenu2019.png" target="_blank">
							<img alt="Performance Menu" src="/img/2019/2019-01-performancemenu2019.png">
						</a>
					</p>
					<p>That gives options for selecting what to monitor and what sort of measuring to do. Plus it also helpfully tells you when you're about to try to profile code in debug mode:</p>
					<p>
						<a href="/img/2019/2019-01-performanceoptions.png" target="_blank">
							<img alt="Performance Options" src="/img/2019/2019-01-performanceoptions.png">
						</a>
					</p>
					<p>If you're looking to profile an app being built and started by Visual Studio, or a website that can run under its local website hosting and debugging then all looks good. You can get profiling that looks and behaves much the same as in VS2017. My favourite "Modules" view for detailed profiling is still there, as you can choose to generate an "instrumentation profiling" report:</p>
					<p>
						<a href="/img/2019/2019-01-instrumentation.png" target="_blank">
							<img alt="Instrumentation" src="/img/2019/2019-01-instrumentation.png">
						</a>
					</p>
					<p>and pick the Modules view from the "Current View" dropdown at the top of the report page:</p>
					<p>
						<a href="/img/2019/2019-01-detailoptions.png" target="_blank">
							<img alt="Detail Options" src="/img/2019/2019-01-detailoptions.png">
						</a>
					</p>
					<p>But once you start trying to profile Sitecore, thats where things start to go wrong...</p>
					<h2>The problem I found:</h2>
					<p>In order to be useful for Sitecore developers, you need to be able to profile code that's not running under Visual Studio's web hosting – you need to be able to attach to IIS. I've tried two ways of doing this, and neither seemed to be successful.</p>
					<p>When I use the UI above, I can choose "Change Target" to select a running process:</p>
					<p>
						<a href="/img/2019/2019-04-untitled.png" target="_blank">
							<img alt="Running Process" src="/img/2019/2019-04-untitled.png">
						</a>
					</p>
					<p>But when I do that I have two issues. Firstly, the dialog for picking the process doesn't give enough information to easily pick the right process:</p>
					<p>
						<a href="/img/2019/2019-04-chooseprocess.png" target="_blank">
							<img alt="Choose Process" src="/img/2019/2019-04-chooseprocess.png">
						</a>
					</p>
					<p>It doesn't show the App Pool identity – which makes picking out the Sitecore process from the xConnect / Identity Service one (or any other website) difficult. I needed to use another mechanism to find the right process ID. (I looked at the "Debug / Attach to Process" dialog – which still shows that data) But having done that, when I pick the process I wanted, I found another issue:</p>
					<p>
						<a href="/img/2019/2019-04-onlycpu.png" target="_blank">
							<img alt="Only CPU Usage" src="/img/2019/2019-04-onlycpu.png">
						</a>
					</p>
					<p>It removes all the options other than "CPU profiling". You can no longer pick Instrumentation, or any of the other types – and that means you get much less useful data. When I try it against a simple plain ASP.Net MVC web app I get a report like this:</p>
					<p>
						<a href="/img/2019/2019-04-basicreport.png" target="_blank">
							<img alt="Basic Report" src="/img/2019/2019-04-basicreport.png">
						</a>
					</p>
					<p>And when I tried it against a site running Sitecore with some View Renderings, I only got a couple of rows on this report.</p>
					<p>So as an alternative I tried configuring my test project to start the IIS site rather attaching to the web server process. To be honest, I didn't think this was going to work, but it was worth trying:</p>
					<p>
						<a href="/img/2019/2019-04-startupbinding.png" target="_blank">
							<img alt="Startup Binding" src="/img/2019/2019-04-startupbinding.png">
						</a>
					</p>
					<p>You can now choose "Startup Project" from the diagnostic and profiling form now, and in turn that leaves the instrumentation profiling option enabled:</p>
					<p>
						<a href="/img/2019/2019-04-startupproject.png" target="_blank">
							<img alt="Startup Project" src="/img/2019/2019-04-startupproject.png">
						</a>
					</p>
					<p>And the profiler will indeed start, show you your web app in a browser window and appear to gather data. But once I exercised my app and stopped the profiler again, I didn't get to see a report. Nothing seemed to happen. Looking at the output window, I was seeing something like:</p>
					<pre class="code" data-enlighter-theme="droide-text" data-enlighter-language="text" style="width:100%; overflow:scroll;">Preparing web server for profiling.
Warning VSP2347: The monitor was unable to start the VS performance driver.  Windows cannot verify the digital signature for this file. A recent hardware or software change might have installed a file that is signed incorrectly or damaged, or that might be malicious software from an unknown source. Consider using the /Admin:Driver,Start and /Admin:Security options of VSPerfCmd from an elevated environment.  Performance counter data and detection of kernel mode execution is disabled.
Profiling started.
Instrumenting C:\Users\djdav\source\repos\PerfTest\PerfTest\\bin\PerfTest.dll in place
Info VSP3049: Small functions will be excluded from instrumentation.
Microsoft (R) VSInstr Post-Link Instrumentation 16.0.28713.1 x86
Analyzing component...
Instrumenting component...
##                   (5.56 %%)
###                  (11.11 %%)
####                 (16.67 %%)
#####                (22.22 %%)
######               (27.78 %%)
#######              (33.33 %%)
########             (38.89 %%)
#########            (44.44 %%)
###########          (50.00 %%)
############         (55.56 %%)
#############        (61.11 %%)
##############       (66.67 %%)
###############      (72.22 %%)
################     (77.78 %%)
#################    (83.33 %%)
##################   (88.89 %%)
###################  (94.44 %%)
#################### (100.00 %%)
Successfully instrumented file C:\Users\djdav\source\repos\PerfTest\PerfTest\\bin\PerfTest.dll.
Launching web server with profiling.
Launching profilable project.
Data written to C:\Users\djdav\AppData\Local\Temp\Report20190427-2230.vsp.
Profiling finished.
Profiling complete.

					</pre>
					<p>The "Windows cannot verify the digital signature for this file" error at the top seems odd. And the fact that it has applied instrumentation to the file in the project bin directory, not the process being attached isn't great. (Though I did make sure the latest binary, plus the extra pdb file that appears to have been generated for diagnostics got copied over to the IIS site's bin folder)</p>
					<p>And, to cap it all, if I try to open the .vsp report file mentioned directly, I got:</p>
					<p>
						<a href="/img/2019/2019-04-nobufferserror.png" target="_blank">
							<img alt="No Buffers Error" src="/img/2019/2019-04-nobufferserror.png">
						</a>
					</p>
					<p>And no report window was opened. That set of messages and problems makes me suspect that this approach is not actually attaching the performance monitoring to the IIS process correctly – but my knowledge of how this all works under the surface isn't good enough to understand why right now.</p>
					<p>(I've tried the command-line approach suggested by the messages above, and the switches mentioned, but they gave much the same error messages)</p>
					<h2>Conclusions...</h2>
					<p>I've done some googling around these issues and errors, but everything I've found so far talks about problems with older versions of Visual Studio. These posts are also mostly related to C++ or .Net Core projects. I've yet to find anything discussing these issues in VS2019 for .Net sites run under IIS. So, to be honest, I'm not sure if I'm just doing this wrong because of what's changed, or if there's actually a problem in Visual Studio. Either way, my Google-Fu has failed me.</p>
					<p>But until I find an answer or a workaround to this, I'm going to stick with VS2017 when I need to do performance measurement. It may not have all the bells and whistles of the latest release, but I can make it profile Sitecore running in an IIS site – and that's what's key for me.</p>
					<p>If anyone reading this knows what I'm doing wrong then let me know – I'd be happy to be able to replace this post with one describing how to do this correctly for Sitecore sites.</p>
					<p>And meanwhile I'll try to find time send some feedback to Microsoft, to see if they can help me.</p>
					<a class="gotop" href="#top">↑ Back to top</a>
				</div>
				<div class="sidebar lg:flex-none lg:w-64 m-0 mt-1 lg:mt-0 lg:p-1 lg:bg-gray-100">
					<section class="mvp">
						<h3 class="bg-gray-300 p-2">Sitecore MVP 2015-2023</h3>
						<div class="bg-white mb-2 p-2">
							<a href="/mvp">
								<img class="lg:mx-auto" src="/img/mvp/2023.png" width="219" height="219" alt="2023 MVP Badge">
							</a>
						</div>
					</section>
					<section>
						<h3 class="bg-gray-300 p-2">Top Tags</h3>
						<div class="bg-white p-2 flex flex-wrap">
							<a href="/tags/sitecore/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
								Sitecore (217)</a>
							<a href="/tags/c/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
								C# (54)</a>
							<a href="/tags/powershell/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
								PowerShell (31)</a>
							<a href="/tags/installation/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
								Installation (23)</a>
							<a href="/tags/solr/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
								Solr (19)</a>
							<a href="/tags/general/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
								General (16)</a>
							<a href="/tags/docker/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
								Docker (16)</a>
							<a href="/tags/ui/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
								UI (15)</a>
							<a href="/tags/containers/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
								Containers (13)</a>
							<a href="/tags/bug/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
								Bug (12)</a>
						</div>
						<div class="bg-white mb-2 p-2">
							<a class="" href="/tags" role="button">All Tags
								<i class="fas fa-angle-double-right"></i>
							</a>
						</div>
					</section>
					<section>
						<h3 class="bg-gray-300 p-2">Recent Months</h3>
						<div class="bg-white p-2">
							<div>
								<a class="text-lg" href="/posts/2023-08">2023 - August</a>
							</div>
							<div>
								<a class="text-lg" href="/posts/2023-07">2023 - July</a>
							</div>
							<div>
								<a class="text-lg" href="/posts/2023-06">2023 - June</a>
							</div>
							<div>
								<a class="text-lg" href="/posts/2023-05">2023 - May</a>
							</div>
							<div>
								<a class="text-lg" href="/posts/2023-04">2023 - April</a>
							</div>
						</div>
						<div class="bg-white mb-2 p-2">
							<a class="" href="/posts" role="button">All Posts
								<i class="fas fa-angle-double-right"></i>
							</a>
						</div>
					</section>
					<section>
						<h3 class="bg-gray-300 p-2">Socials</h3>
						<div class="bg-white mb-2 p-2">
							<div>
								<a rel="me" target="_blank" href="https://mastodon.social/@jermdavis">Mastodon</a>
							</div>
							<div>
								<a rel="me" target="_blank" href="https://www.linkedin.com/in/djdavis/">LinkedIn</a>
							</div>
							<div>
								<a rel="me" target="_blank" href="https://twitter.com/jermdavis">Twitter</a>
							</div>
						</div>
					</section>
				</div>
			</div>
		</div>
		<footer class="lg:flex order-1 bg-gray-100 px-4 lg:px-6 py-4">
			<div class="flex-1 lg:flex-1 text-center lg:text-left">
				<div>©
					<a target="_blank" class="font-medium" rel="noopener" href="https://jermdavis.dev/">Jeremy Davis</a>
					2014-2023</div>
			</div>
			<div class="lg:flex-1 lg:order-3 text-center lg:text-right">
				<a class="font-medium" href="/tools">Published using Statiq</a>
				<br>
			</div>
			<ul class="list-none lg:flex-1 lg:order-2 p-0 text-center lg:align-middle" style="margin:0px !important">
				<li class="inline-block">
					<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
					</svg>
				</li>
				<li class="inline-block ml-4">
					<a class="font-medium" target="_blank" href="/feed.rss">RSS</a>
				</li>
				<li class="inline-block ml-4">
					<a class="font-medium" target="_blank" href="/feed.atom">Atom</a>
				</li>
			</ul>
		</footer>
		<div class="min-h-screen bg-gray-300 py-6 flex flex-col justify-center sm:py-12" x-data="{ hide_banner: true }" x-init="hide_banner = docCookies.hasItem('hide_banner');" x-bind:class="{ 'hidden': hide_banner, 'fixed': !hide_banner }">
			<div class="border-2 border-gray-600 bg-gray-100 max-w-screen-lg mx-auto fixed bg-white inset-x-5 p-5 bottom-10 rounded-lg drop-shadow-2xl flex gap-4 flex-wrap md:flex-nowrap text-center md:text-left items-center justify-center md:justify-between">
				<div class="w-full text-lg">
					<a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage" rel="noreferrer" target="_blank">This website uses Google Analytics, and its cookies.</a>
				</div>
				<button type="button" @click="hide_banner = true; docCookies.setItem('hide_banner', true, 'Fri, 31 Dec 9999 23:59:59 GMT', null, null, null, 'strict');" class="bg-gray-400 px-5 py-2 text-white rounded-md hover:bg-gray-600 focus:outline-none" aria-label="Dismiss">Understood</button>
			</div>
		</div>
		<script src="/vendor/Alpine/alpine.3.7.1.min.js" defer=""></script>
		<script src="/vendor/Enlighter/enlighterjs.min.js"></script>
		<script type="text/javascript">
            EnlighterJS.init('pre.code', 'code', {
            theme: 'droide',
            indent : 4,
            linehover : false,
            textOverflow: 'scroll',
            toolbarTop: '',
            toolbarBottom: ''
        });
        
		</script>
		<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JQ44ZR47YX"></script>
		<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-JQ44ZR47YX');
    
		</script>
	</body>
</html>