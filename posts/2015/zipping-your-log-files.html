<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="Sitecore, C# and web development">
        <meta name="author" content="Jeremy Davis">
        <meta name="copyright" content="Jeremy Davis">

    <title>Jeremy Davis - Zipping your log&nbsp;files...</title>

    <link rel="canonical" href="https://blog.jermdavis.dev/posts/2015/zipping-your-log-files">
    <meta name="robots" content="noindex, nofollow">

            <link type="application/rss+xml" rel="alternate" href="/feed.rss">
            <link type="application/atom+xml" rel="alternate" href="/feed.atom">

    <meta name="application-name" content="Jeremy Davis">
    <meta name="msapplication-tooltip" content="Jeremy Davis">
    <meta name="msapplication-starturl" content="/">
    <link rel="manifest" href="/manifest.json">

    
    <meta property="og:title" content="Jeremy Davis - Zipping your log&nbsp;files...">
        <meta property="og:image" content="/img/featured/zipping-your-log-files-social.png">
    <meta property="og:description" content="">
<meta property="og:url" content="https://blog.jermdavis.dev/posts/2015/zipping-your-log-files">
<meta property="og:type" content="website">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

    <link href="https://unpkg.com/tailwindcss@2.2.11/dist/tailwind.min.css" rel="stylesheet">

    <link href="/vendor/Enlighter/enlighterjs.min.css" rel="stylesheet">
    <link href="/scss/site-theme.css" rel="stylesheet">


    <script src="/vendor/Cookies/cookies.min.js" defers=""></script>

    

    
</head>

<body class="max-w-7xl mx-auto">
    <div class="relative bg-white" x-data="{ open: false }">

    <!-- desktop -->
    <div class="px-4 lg:px-6 bg-gray-100">
        <div class="flex justify-between items-center border-b-2 border-gray-100 py-6 lg:justify-start lg:space-x-10">

            <div class="flex justify-start lg:w-0 flex-1">
                <a href="/">
                    <img class="h-12 mt-2 w-auto lg:h-14" src="/img/Profile.jpg" alt="Jeremy Davis">
                </a>
                <div class="mx-2">
                    <div class="text-3xl">Jeremy Davis</div>
                    <div class="text-lg">Sitecore, C# and web development</div>
                </div>
            </div>

            <div class="-mr-2 -my-2 lg:hidden">
                <button @click="open = true" type="button" class="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" aria-expanded="false">
                    <span class="sr-only">Open menu</span>
                    <!-- Heroicon name: outline/menu -->
                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>

            <nav class="hidden lg:flex space-x-10">
<a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/posts">Posts</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/tags">Tags</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/about">About</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/links">Useful Links</a><a class="text-base font-medium text-gray-500 hover:text-gray-900" href="/mvp">MVP</a>            </nav>

        </div>
    </div>

    <!--Mobile menu, show/hide based on mobile menu state.-->
    <div class="absolute top-0 inset-x-0 p-2 transition transform origin-top-right lg:hidden z-50">

        <div class="rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 bg-white divide-y-2 divide-gray-50" x-show="open" x-transition="">
            <div class="pt-5 pb-6 px-5">
                <div class="flex items-center justify-between">
                    <div class="flex">
                        <a href="/">
                            <img class="h-12 mt-2 w-auto" src="/img/Profile.jpg" alt="Jeremy Davis">
                        </a>
                        <div class="mx-2">
                            <div class="text-2xl">Jeremy Davis</div>
                            <div class="text-base">Sitecore, C# and web development</div>
                        </div>
                    </div>

                    <div class="-mr-2">
                        <button @click="open = false" type="button" class="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
                            <span class="sr-only">Close menu</span>
                            <!-- Heroicon name: outline/x -->
                            <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="py-6 px-5 pt-0">
                <nav class=" gap-x-8">
<a class="block mt-5 text-base font-medium text-gray-500 hover:text-gray-900" href="/posts">Posts</a><a class="block mt-5 text-base font-medium text-gray-500 hover:text-gray-900" href="/tags">Tags</a><a class="block mt-5 text-base font-medium text-gray-500 hover:text-gray-900" href="/about">About</a><a class="block mt-5 text-base font-medium text-gray-500 hover:text-gray-900" href="/links">Useful Links</a><a class="block mt-5 text-base font-medium text-gray-500 hover:text-gray-900" href="/mvp">MVP</a>                </nav>
            </div>

        </div>
    </div>
</div>

    <header class="bg-gray-300 px-4 py-1 lg:px-6 text-center" style="background-image: url(&quot;/&quot;);">
    <div class="post-heading">
        <h1 class="text-5xl mb-4 pb-1">
        Zipping your log&nbsp;files...
        </h1>
            <div class="meta">Published 23 February 2015</div>
                <div class="meta">Updated 25 August 2016</div>
            <div class="flex py-1">
                    <a href="/tags/sitecore" class="p-1 mr-1 bg-gray-100 rounded-md"> Sitecore</a>
            </div>
    </div>
</header>

    <div class="py-2 lg:pl-3">
        <div class="lg:flex">
            <div class="lg:flex-auto mx-3 lg:min-w-0 content">
                <p>Whenever you're making requests to a Sitecore instance, you're generating log data. Sitecore does include a scheduled tasks using the <code>Sitecore.Tasks.CleanupAgent</code> to remove old log entries. However what happens if you don't want to delete old logs? Recently I was talking to a developer who needed to keep them but also save disk space. So I hacked up a quick example of one way you might schedule zipping the logs through Sitecore. (rather than via the Windows scheduler or some other route) I'm reproducing it here in case it's of use to anyone else.<!--more--></p>
<p>Classes implementing code you want to schedule don't need any special base classes or interfaces, they just need to expose a public method. To zip up old log files we need some simple code in our method to:</p>
<ul>
<li>Calculate a date for the age of logs we want to archive</li>
<li>Find all the log files that fit this range</li>
<li>Create an archive and add these files</li>
<li>Remove the log files</li>
</ul>
<p>In .Net 4.5 and later we can do this with the following simple code:</p>
<pre data-enlighter-language="csharp" style="width:100%; overflow:scroll;">public class LogArchiver 
{
    public void Run()
    {
        Sitecore.Diagnostics.Log.Info("Running log cleanup...", this);

        DateTime filterDate = DateTime.Now.AddDays(-1).Date;

        string logFolder = Path.Combine(Sitecore.Configuration.Settings.DataFolder, "logs");
        DirectoryInfo di = new DirectoryInfo(logFolder);

        var files = di.EnumerateFiles("*.txt")
            .Where(f =&gt; f.LastWriteTime &lt;= filterDate);

        if(files.Any())
        {
            string zipFile = Path.Combine(logFolder, string.Format("LogArchive-{0}-{1}-{2}.zip", filterDate.Year, filterDate.Month, filterDate.Day));

            using (var zip = ZipFile.Open(zipFile, ZipArchiveMode.Create))
            {
                foreach (var file in files)
                {
                    var entry = zip.CreateEntryFromFile(file.FullName, file.Name);
                    File.Delete(file.FullName);
                }
            }
        }
    }
}
</pre>
<p>The compression classes in .Net 4.5 make the code to put files into a zip simple – but it's worth pointing out that you need to make sure you have <code>System.IO.Compression</code> in your <code>using</code> statements. The <code>CreateEntryFromFile()</code> method is an extension method, so the code above doesn't compile if you use fully qualified type names when creating the <code>ZipFile</code> object.</p>
<p>Alternatively, if you're working in older versions of the .Net framework you can use one of the third party compression libraries available such as <a href="http://dotnetzip.codeplex.com/" target="_blank" rel="noopener noreferrer">DotNetZip</a> or <a href="http://icsharpcode.github.io/SharpZipLib/" target="_blank" rel="noopener noreferrer">SharpZipLib</a>.</p>
<p>Once you've put your code together it can be configured to run regularly in one of two different ways. The first is using a configuration patch:</p>
<pre data-enlighter-language="xml" style="width:100%; overflow:scroll;">&lt;configuration xmlns:patch="http://www.sitecore.net/xmlconfig/"&gt;
  &lt;sitecore&gt;
    &lt;scheduling&gt;
      &lt;agent type="Testing.LogArchiver" method="Run" interval="01:00:00" /&gt;
    &lt;/scheduling&gt;
  &lt;/sitecore&gt;
&lt;/configuration&gt;
</pre>
<p>You supply the fully qualified type name along with the method name you want executed, and an execution interval in "hrs:mins:secs" format. This approach is most suitable to situations where the developers need to control the schedule of execution and it's not expected to change much.</p>
<p>Alternatively you can set up the event through the Content Editor if your scenario needs the schedule to be more easily flexible. While it's not entirely suitable for users to modify it, this approach allows changing the schedule via content rather than configuration. This involves creating <code>Command</code> and <code>Schedule</code> items in the folders under <code>/sitecore/system/Tasks</code>. The command again takes a fully qualified type and method name:</p>
<p><a href="/img/2015/2015-02-command.png" target="_blank"><img alt="Command" src="/img/2015/2015-02-command.png"></a></p>
<p>The schedule item references the command, and also specifies a string that defines the schedule to execute the task on:</p>
<p><a href="/img/2015/2015-02-schedule.png" target="_blank"><img alt="Schedule" src="/img/2015/2015-02-schedule.png"></a></p>
<p>The random looking string for the schedule data describes the date range, days of the week and interval that the task should be executed on. The <a href="http://www.sitecore.net/Learn/Blogs/Technical-Blogs/John-West-Sitecore-Blog/Posts/2010/11/All-About-Sitecore-Scheduling-Agents-and-Tasks.aspx" target="_blank" rel="noopener noreferrer">details of this are explained in the scheduled task section of this blog post by John West</a>.</p>
<p>And with that in place, each time your schedule fires all the log files from a day ago will be moved to a zip file:</p>
<p><a href="/img/2015/2015-02-zipped1.png" target="_blank"><img alt="Zipped" src="/img/2015/2015-02-zipped1.png"></a></p>


            </div>
            <div class="lg:flex-none lg:w-72 m-0 mt-1 lg:mt-0 lg:p-1 lg:bg-gray-100">
                <section class="mvp">
    <h3 class="bg-gray-300 p-2">Sitecore MVP 2015-2021</h3>
    <div class="bg-white mb-2 p-2"><a href="/mvp"><img src="/img/mvp/2021.jpg" alt="2021 MVP Badge"></a></div>
</section>

<section>
    <h3 class="bg-gray-300 p-2">Top Tags</h3>
    <div class="bg-white p-2 flex flex-wrap">
                    <a href="/tags/sitecore" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1"> Sitecore (193)</a>
                    <a href="/tags/c" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1"> C# (45)</a>
                    <a href="/tags/powershell" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1"> PowerShell (31)</a>
                    <a href="/tags/installation" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1"> Installation (23)</a>
                    <a href="/tags/solr" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1"> Solr (15)</a>
                    <a href="/tags/ui" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1"> UI (14)</a>
                    <a href="/tags/general" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1"> General (12)</a>
                    <a href="/tags/coveo" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1"> Coveo (12)</a>
                    <a href="/tags/visual-studio" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1"> Visual Studio (11)</a>
                    <a href="/tags/docker" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1"> Docker (10)</a>
    </div>
    <div class="bg-white mb-2 p-2">
        <a class="" href="/tags" role="button">All Tags <i class="fas fa-angle-double-right"></i></a>
    </div>
</section>

<section>
    <h3 class="bg-gray-300 p-2">Recent Months</h3>
    <div class="bg-white p-2">
                <div><a class="text-lg" href="/posts/2021-11">2021 - November</a></div>
                <div><a class="text-lg" href="/posts/2021-10">2021 - October</a></div>
                <div><a class="text-lg" href="/posts/2021-09">2021 - September</a></div>
                <div><a class="text-lg" href="/posts/2021-08">2021 - August</a></div>
                <div><a class="text-lg" href="/posts/2021-07">2021 - July</a></div>
    </div>
    <div class="bg-white mb-2 p-2">
        <a class="" href="/posts" role="button">All Posts <i class="fas fa-angle-double-right"></i></a>
    </div>
</section>

<section>
    <h3 class="bg-gray-300 p-2">Twitter</h3>
    <div class="bg-white mb-2 p-2">
        <a class="twitter-timeline" data-height="400" data-chrome="noheader nofooter noborders" href="https://twitter.com/jermdavis">Tweets by JermDavis</a>
        <script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    </div>
</section>
            </div>
        </div>
    </div>

    <footer class="lg:flex order-1 bg-gray-100 px-4 lg:px-6 py-4">
    <div class="flex-1 lg:flex-1 text-center lg:text-left">
        <div>© <a target="_blank" class="font-medium text-gray-500 hover:text-gray-900" href="https://jermdavis.dev/">Jeremy Davis</a> 2014-2021</div>
    </div>

    <div class="lg:flex-1 lg:order-3 text-center lg:text-right">
        <a class="font-medium text-gray-500 hover:text-gray-900" href="/tools">Published using Statiq</a><br>
    </div>

    <ul class="list-none lg:flex-1 lg:order-2 p-0 text-center lg:align-middle" style="margin:0px !important">
        <li class="inline-block">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
            </svg>
        </li>
            <li class="inline-block ml-4">
                <a class="font-medium text-gray-500 hover:text-gray-900" target="_blank" href="/feed.rss">RSS</a>
            </li>
            <li class="inline-block ml-4">
                <a class="font-medium text-gray-500 hover:text-gray-900" target="_blank" href="/feed.atom">Atom</a>
            </li>
    </ul>
</footer>

    <div class="min-h-screen bg-gray-300 py-6 flex flex-col justify-center sm:py-12" x-data="{ hide_banner: true }" x-init="hide_banner = docCookies.hasItem('hide_banner');" x-bind:class="{ 'hidden': hide_banner, 'fixed': !hide_banner }">
        <div class="border-2 border-gray-600 bg-gray-100 max-w-screen-lg mx-auto fixed bg-white inset-x-5 p-5 bottom-10 rounded-lg drop-shadow-2xl flex gap-4 flex-wrap md:flex-nowrap text-center md:text-left items-center justify-center md:justify-between">
            <div class="w-full text-lg">
                This website uses Google Analytics, and its cookies.
                <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage" rel="noreferrer" target="_blank" class="whitespace-nowrap">Learn more</a>
            </div>
            <button type="button" @click="hide_banner = true; docCookies.setItem('hide_banner', true, (7*24*60*60));" class="bg-gray-400 px-5 py-2 text-white rounded-md hover:bg-gray-600 focus:outline-none" aria-label="Dismiss">Understood</button>
        </div>
    </div>
    
    <script src="https://unpkg.com/alpinejs" defer=""></script>    
    <script src="/vendor/Enlighter/enlighterjs.min.js"></script>

    <script type="text/javascript">
        EnlighterJS.init('pre', 'code', {
            theme: 'droide',
            indent : 4,
            linehover : false,
            textOverflow: 'scroll',
            toolbarTop: '{BTN_RAW}{BTN_COPY}',
            toolbarBottom: ''
        });
    </script>

    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JQ44ZR47YX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-JQ44ZR47YX');
    </script>

    

    



</body></html>