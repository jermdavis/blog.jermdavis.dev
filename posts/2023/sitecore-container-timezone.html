<!DOCTYPE html>
<html lang="en">
	<head>
		<script src="/js/theme.js"></script>
		<meta charset="utf-8">
		<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' unpkg.com www.googletagmanager.com *.google-analytics.com; img-src 'self' data: *;style-src 'self' 'unsafe-inline'">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="canonical" href="https://blog.jermdavis.dev/posts/2023/sitecore-container-timezone">
		<meta name="description" content="Important settings for controlling time zones in containerised Sitecore">
		<meta property="og:description" content="Important settings for controlling time zones in containerised Sitecore">
		<meta name="keywords" content="Sitecore, Platform DXP, Configuration, Containers">
		<meta name="author" content="Jeremy Davis">
		<meta name="copyright" content="Jeremy Davis">
		<title>Jeremy Davis - Sitecore, time zones and containers</title>
		<meta name="robots" content="index, follow">
		<link type="application/rss+xml" rel="alternate" title="Jeremy Davis - Sitecore, C# and web development" href="/feed.rss">
		<link type="application/atom+xml" rel="alternate" title="Jeremy Davis - Sitecore, C# and web development" href="/feed.atom">
		<meta name="application-name" content="Jeremy Davis">
		<meta name="msapplication-tooltip" content="Jeremy Davis">
		<meta name="msapplication-starturl" content="/">
		<link rel="manifest" href="/manifest.webmanifest">
		<meta property="og:type" content="article">
		<meta property="og:title" content="Sitecore, time zones and containers [by Jeremy Davis]">
		<meta property="og:publish_date" content="2023-05-22T00:00:00+0000">
		<meta property="article:published_time" content="2023-05-22T00:00:00+0000">
		<meta property="og:image" content="https://blog.jermdavis.dev/img/featured/sitecore-container-timezone-social.jpg">
		<meta property="og:image:alt" content="Logo image showing post title 'Sitecore, time zones and containers' and author 'Jeremy Davis'">
		<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "article",
        "headline": "Sitecore, time zones and containers",
        "url": "https://blog.jermdavis.dev/posts/2023/sitecore-container-timezone",
        "image": [
            {
                "@type": "ImageObject",
                "contentUrl": "https://blog.jermdavis.dev/img/featured/sitecore-container-timezone-social.jpg",
                "caption": "Logo image showing post title 'Sitecore, time zones and containers' and author 'Jeremy Davis'"
            }
        ],
        "datePublished": "2023-05-22T00:00:00+0000",
        "author": [{
            "@type": "Person",
            "name": "Jeremy Davis",
            "url": "https://jermdavis.dev/"
        }]
    }
    
		</script>
		<meta property="og:url" content="https://blog.jermdavis.dev/posts/2023/sitecore-container-timezone">
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
		<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">
		<link href="/vendor/Enlighter/enlighterjs.min.css" rel="stylesheet">
		<link href="/dist/main.css" rel="stylesheet">
		<script src="/vendor/Cookies/cookies.min.js" defer=""></script>
	</head>
	<body class="blog" x-bind:class="dk ? 'dark' : ''" id="top">
		<div id="rp-bar"></div>
		<div class="blogNavContainer" x-data="{ open: false }">
			<div class="blogNav">
				<div class="bannerContainer">
					<div class="bannerRow">
						<a href="/">
							<img class="mt-2" width="56" height="56" src="/img/Profile.jpg" alt="Jeremy Davis">
						</a>
						<div class="mx-2">
							<div class="text-3xl">Jeremy Davis</div>
							<div class="text-lg">Sitecore, C# and web development</div>
						</div>
					</div>
					<div class="nav navBurger">
						<button @click="open = true" type="button" class="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" aria-expanded="false">
							<span class="sr-only">Open menu</span>
							<svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
							</svg>
						</button>
					</div>
					<nav class="nav navItemSet">
						<a href="/posts">Posts</a>
						<a href="/tags">Tags</a>
						<a href="/about">About</a>
						<a href="/links">Useful Links</a>
						<a href="/mvp">MVP</a>
						<a href="/search">Search</a>
						<button x-cloak="" x-on:click="Clicked('2')" x-show="$store.theme == '1'">
							<img src="/img/Auto.png" width="32" height="32" alt="Auto" title="Automatic theme">
						</button>
						<button x-cloak="" x-on:click="Clicked('3')" x-show="$store.theme == '2'">
							<img src="/img/Light.png" width="32" height="32" alt="Auto" title="Light theme">
						</button>
						<button x-cloak="" x-on:click="Clicked('1')" x-show="$store.theme == '3'">
							<img src="/img/Dark.png" width="32" height="32" alt="Auto" title="Dark theme">
						</button>
					</nav>
				</div>
			</div>
			<div class="mobileContainer">
				<div style="display:none;" class="popupBox" x-show="open" x-transition="">
					<div class="popupHead">
						<div class="popupHeadInner">
							<div class="titleRow">
								<a href="/">
									<img width="56" height="56" src="/img/Profile.jpg" alt="Jeremy Davis">
								</a>
								<div class="mx-2">
									<div class="text-2xl">Jeremy Davis</div>
									<div class="text-base">Sitecore, C# and web development</div>
								</div>
							</div>
							<div class="nav menuRow">
								<button @click="open = false" type="button">
									<span class="sr-only">Close menu</span>
									
									<!-- Heroicon name: outline/x -->
									<svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
									</svg>
								</button>
							</div>
						</div>
					</div>
					<div class="nav popupItemsOuter">
						<nav class="gap-x-8">
							<a href="/posts">Posts</a>
							<a href="/tags">Tags</a>
							<a href="/about">About</a>
							<a href="/links">Useful Links</a>
							<a href="/mvp">MVP</a>
							<a href="/search">Search</a>
							<button x-cloak="" x-on:click="Clicked('2')" x-show="$store.theme == '1'">
								<img src="/img/Auto.png" width="32" height="32" alt="Auto" title="Automatic theme">
							</button>
							<button x-cloak="" x-on:click="Clicked('3')" x-show="$store.theme == '2'">
								<img src="/img/Light.png" width="32" height="32" alt="Auto" title="Light theme">
							</button>
							<button x-cloak="" x-on:click="Clicked('1')" x-show="$store.theme == '3'">
								<img src="/img/Dark.png" width="32" height="32" alt="Auto" title="Dark theme">
							</button>
						</nav>
					</div>
				</div>
			</div>
		</div>
		<header class="headerContainer" style="">
			<div class="post-heading">
				<div class="url printBanner">Article printed from:
					<tt>https://blog.jermdavis.dev/posts/2023/sitecore-container-timezone</tt>
				</div>
				<h1>
					Sitecore, time zones and containers
				</h1>
				<h2>Wherever it pops up, time-based stuff is tricky</h2>
				<div class="meta">Published 22 May 2023</div>
				<div class="tagList">
					<a href="/tags/sitecore/">
						Sitecore</a>
					<a href="/tags/platform-dxp/">
						Platform DXP</a>
					<a href="/tags/configuration/">
						Configuration</a>
					<a href="/tags/containers/">
						Containers</a>
					<span>~3 min. read</span>
				</div>
			</div>
		</header>
		<div class="blogContainerOuter">
			<div class="blogContainerInner">
				<div class="leftCol content">
					<p>To customise
						<a href="https://martinfowler.com/bliki/TwoHardThings.html" target="_blank" rel="noopener">a very old joke</a>, there are only two difficult issues in IT: Naming things, Time calculations<a href="https://en.wikipedia.org/wiki/Serial_comma" target="_blank" rel="noopener">,</a>
						and off-by-one errors. And adding containers into the mix raises even more fun. I recently hit an issue where containerised Sitecore needed to use a different time zone to the physical servers it was hosted on. So what can be done to configure this? Here's two things that can help:</p>
					<h2 x-data="" class="anchor">The Sitecore config
						<a title="click to copy url" x-on:click.prevent="copy($event.target)" href="#heading1" name="heading1">
							<img src="/img/link.png">
						</a>
						<span>url copied!</span>
					</h2>
					<p>The issue of server time zones has been around a fairly long time. So Sitecore does have some configuration to try and help here. Internally it tries to manage dates and times using UTC rather than a local timezone. But that data sometimes needs converting for display. So the
						<code>sitecore.config</code>
						file
						<a href="https://doc.sitecore.com/xp/en/developers/103/sitecore-experience-manager/settings-supporting-utc-implementation.html" target="_blank" rel="noopener">includes a setting</a>
						named
						<code>ServerTimeZone</code>
						to manage this, which you can patch to your required location. For me, in England, that might be:</p>
					<pre class="code" data-enlighter-language="xml" style="width:100%; overflow:scroll;">&lt;?xml version="1.0"?&gt;
&lt;configuration xmlns:patch="http://www.sitecore.net/xmlconfig/"&gt;
    &lt;sitecore&gt;
        &lt;settings&gt;
            &lt;setting name="ServerTimeZone"&gt;
                &lt;patch:attribute name="value"&gt;GMT Standard Time&lt;/patch:attribute&gt;
            &lt;/setting&gt;
        &lt;/settings&gt;
    &lt;/sitecore&gt;
&lt;/configuration&gt;

					</pre>
					<p>The value for the setting needs to be the string name of one of the
						<a href="https://learn.microsoft.com/en-us/windows-hardware/manufacture/desktop/default-time-zones?view=windows-11#time-zones" target="_blank" rel="noopener">supported Windows time zones</a>.</p>
					<p>If you need to debug what state a particular server is seeing in your code then
						<code>TimeZone.CurrentTimeZone</code>
						<a href="https://learn.microsoft.com/en-us/dotnet/api/system.timezone.currenttimezone?view=netframework-4.8" target="_blank" rel="noopener">is your friend</a>. That has properties for fetching the name of the zone that's being used in the current context.</p>
					<p>So this configuration can allow your servers (or containers) to run under UTC but have the UI display your local time zone automatically. But by default that only works for code which honours that setting. Sitecore does, but if you want to do so in your code then you need to make use of the
						<code>Sitecore.DateUtil</code>
						helper class, which will convert UTC based on this setting:</p>
					<pre class="code" data-enlighter-language="csharp" style="width:100%; overflow:scroll;">var now = DateTime.UtcNow;
var local = Sitecore.DateUtil.ToServerTime(now);

					</pre>
					<h2 x-data="" class="anchor">The containers
						<a title="click to copy url" x-on:click.prevent="copy($event.target)" href="#heading2" name="heading2">
							<img src="/img/link.png">
						</a>
						<span>url copied!</span>
					</h2>
					<p>By default, a container picks up the time zone of its host. So the most wide-acting way to change the timezone for your code is to set the time zone on your host. But that's not always easy to do - in fact that's exactly the issue that got me thinking about this.. So you may need other approaches.</p>
					<p>That's all well and good for code in Sitecore, or which obeys Sitecore's patterns. But what happens if you need code outside that scope to have a different time zone to a physical Kubernetes Node VM?</p>
					<p>Well recent versions of Windows' container runtime have your back here. The time zone setting is virtualised between a Windows container and its host's operating system. So your nodes can be set to whatever, and your containers can run with your required setting. But it requires a little extra work.</p>
					<p>Microsoft
						<a href="https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/tzutil" target="_blank" rel="noopener">provide a tool</a>
						called
						<code>tzutil.exe</code>
						which is present on the Windows Server base images. This lets you view and control the current timezone state. And if you run it inside a container, then it's controlling the state of that container, not the base server.</p>
					<p>Running
						<code>tzutil /g</code>
						will show you the current timezone setting.
						<code>tzutil /l</code>
						will display the set of zones available to choose from. And
						<code>tzutil /s &lt;name&gt;</code>
						will let you set the zone for this machine.</p>
					<p>It's worth noting that this command is mirrored by the
						<a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-timezone?view=powershell-7.3" target="_blank" rel="noopener">PowerShell</a>
						<code>Get-Timezone</code>
						and
						<code>Set-Timezone</code>
						commands, if you prefer to use those. That does make it easy to get lists of available zones sorted by name:
						<code>Get-TimeZone -ListAvailable | Select-Object id, DisplayName | Sort-Object id</code>
						or by time difference:
						<code>Get-TimeZone -ListAvailable | Select-Object BaseUtcOffset, id | Sort-Object BaseUtcOffset</code>
						if you need them.</p>
					<p>The
						<a href="https://learn.microsoft.com/en-us/virtualization/windowscontainers/manage-containers/virtual-time-zone" target="_blank" rel="noopener">documentation from Microsoft on this</a>
						suggests you need to start your container and then set the timezone, rather than embedding the setting into the image itself. Running
						<code>tzutil</code>
						in the
						<code>DockerFile</code>
						that creates your image doesn't affect the state of the container when it runs. (A nice little trap for the unwary - like me)</p>
					<p>So how can we get this right for Sitecore?</p>
					<p>Well we've got two situations to cover here: When you start the container as a developer, and when the container starts in a "production" deployment. So that means we need to cover both the Docker and Kubernetes container start processes. The important thing to remember here is that there are different entrypoint scripts for these two scenarios. So any solution needs to make sure it will run in both...</p>
					<p>For the particular setup I was looking at, the default entrypoint is a script called
						<code>RunW3SVCService.ps1</code>
						and while the Docker entrypoint is
						<code>Developer.ps1</code>
						that script ends up calling the
						<code>RunW3SVCService.ps1</code>
						script anyway - so that seems like the appropriate place to make the update. The first 20-odd lines of that script are functions, but the call to
						<code>tzutil</code>
						can be placed after that, before the definition of the
						<code>$exclusionList</code>
						for environment variables:</p>
					<pre class="code" data-enlighter-highlight="12,13" data-enlighter-language="powershell" style="width:100%; overflow:scroll;">  ...
function Handle-ValuesWithQuotes {
    param(
        [string]$Value
    )
    $value = $Value -replace "'", "''"
    $value = $value -replace '"', """"
    
    return $value 
}

Write-Host "-- Setting time zone --"
tzutil /s "GMT Standard Time"

# List of env variables which are computer specific and should be excluded from transferred env variables
$exclusionList = @{
  ...

					</pre>
					<p>(You don't need the
						<code>Write-Host</code>
						here, of course - but it's helpful to have some feedback in the logs that this task has happened when the container starts)</p>
					<p>The requirement I had needed the time zone to be set to the UK no matter where this server was running. But there might be circumstances where you want to pass in this name using an environment variable to make it configurable across different environments, instead of hard-coding it like this.</p>
					<p>But either way, these techniques let you be specific about the zone you want.</p>
					<a class="gotop" href="#top">↑ Back to top</a>
					<ul class="shares">
						<li>
							<b>Feel like sharing?</b>
						</li>
						<li>⇒
							<a target="_blank" rel="nofollow noreferrer" href="https://bsky.app/intent/compose?text=Sitecore, time zones and containers%20https://blog.jermdavis.dev/posts/2023/sitecore-container-timezone">On BlueSky</a>
						</li>
						<li>⇒
							<a target="_blank" rel="nofollow noreferrer" href="https://www.linkedin.com/sharing/share-offsite/?url=https://blog.jermdavis.dev/posts/2023/sitecore-container-timezone">On LinkedIn</a>
						</li>
						<li>⇒
							<a target="_blank" rel="nofollow noreferrer" href="https://mastodonshare.com/?text=Sitecore, time zones and containers&amp;url=https://blog.jermdavis.dev/posts/2023/sitecore-container-timezone">On Mastodon</a>
						</li>
						<li>⇒
							<a target="_blank" rel="nofollow noreferrer" href="mailto:&amp;body=Sitecore, time zones and containers%20https://blog.jermdavis.dev/posts/2023/sitecore-container-timezone">On Email</a>
						</li>
						<li></li>
					</ul>
				</div>
				<div class="rightCol sidebar">
					<div class="barContainer">
						<section class="headingSummary">
							<h3>Post Headings</h3>
							<div>
								<ol class="headings">
									<li>
										<a href="#heading1">The Sitecore config
										</a>
									</li>
									<li>
										<a href="#heading2">The containers
										</a>
									</li>
								</ol>
							</div>
						</section>
						<section class="mvp">
							<h3>Sitecore MVP 2015-2025</h3>
							<div>
								<a href="/mvp">
									<img class="l" src="/img/mvp/program.png" width="219" height="219" alt="2025 MVP Badge">
									<img class="d" src="/img/mvp/program_d.png" width="219" height="219" alt="2025 MVP Badge">
								</a>
							</div>
						</section>
						<section class="recentTags">
							<h3>Recent Tags</h3>
							<div>
								<a href="/tags/performance/">
									Performance
								</a>
								<a href="/tags/sitecore/">
									Sitecore
								</a>
								<a href="/tags/docker/">
									Docker
								</a>
								<a href="/tags/visual-studio/">
									Visual Studio
								</a>
								<a href="/tags/platform-dxp/">
									Platform DXP
								</a>
								<a href="/tags/forms/">
									Forms
								</a>
								<a href="/tags/contentsearch/">
									ContentSearch
								</a>
								<a href="/tags/c/">
									C#
								</a>
								<a href="/tags/net/">
									.Net
								</a>
								<a href="/tags/composable/">
									Composable
								</a>
							</div>
						</section>
						<section class="topTags">
							<h3>Top Tags</h3>
							<div class="list">
								<a href="/tags/sitecore/">
									Sitecore (240)</a>
								<a href="/tags/platform-dxp/">
									Platform DXP (214)</a>
								<a href="/tags/c/">
									C# (66)</a>
								<a href="/tags/powershell/">
									PowerShell (32)</a>
								<a href="/tags/installation/">
									Installation (23)</a>
								<a href="/tags/docker/">
									Docker (20)</a>
								<a href="/tags/solr/">
									Solr (19)</a>
								<a href="/tags/general/">
									General (18)</a>
								<a href="/tags/containers/">
									Containers (17)</a>
								<a href="/tags/ui/">
									UI (15)</a>
							</div>
							<div class="link">
								<a href="/tags" role="button">All Tags &gt;</a>
							</div>
						</section>
						<section class="months">
							<h3>Recent Months</h3>
							<div class="list">
								<a href="/posts/2025-02">2025 - February</a>
								<a href="/posts/2025-01">2025 - January</a>
								<a href="/posts/2024-12">2024 - December</a>
								<a href="/posts/2024-11">2024 - November</a>
								<a href="/posts/2024-10">2024 - October</a>
							</div>
							<div class="link">
								<a href="/posts" role="button">All Months &gt;</a>
							</div>
						</section>
						<section class="socials">
							<h3>Socials</h3>
							<div>
								<table>
									<tbody>
										<tr>
											<td class="icon">
												<a rel="me" target="_blank" href="https://bsky.app/profile/jermdavis.dev">
													<img src="/img/bluesky.png" width="32" height="32" alt="Bluesky Logo">
												</a>
											</td>
											<td class="title">
												<a rel="me" target="_blank" href="https://bsky.app/profile/jermdavis.dev">
													Bluesky
												</a>
											</td>
										</tr>
										<tr>
											<td class="icon">
												<a rel="me" target="_blank" href="https://www.linkedin.com/in/djdavis/">
													<img src="/img/linkedin.png" width="32" height="32" alt="LinkedIn Logo">
												</a>
											</td>
											<td class="title">
												<a rel="me" target="_blank" href="https://www.linkedin.com/in/djdavis/">
													LinkedIn
												</a>
											</td>
										</tr>
										<tr>
											<td class="icon">
												<a rel="me" target="_blank" href="https://sitecorechat.slack.com/team/U73KL641G">
													<img src="/img/slack.png" width="32" height="32" alt="Sitecore Slack Logo">
												</a>
											</td>
											<td class="title">
												<a rel="me" target="_blank" href="https://sitecorechat.slack.com/team/U73KL641G">
													Sitecore Slack
												</a>
											</td>
										</tr>
										<tr>
											<td class="icon">
												<a rel="me" target="_blank" href="https://mastodon.social/@jermdavis">
													<img src="/img/mastodon.png" width="32" height="32" alt="Mastodon Logo">
												</a>
											</td>
											<td class="title">
												<a rel="me" target="_blank" href="https://mastodon.social/@jermdavis">
													Mastodon
												</a>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
		<footer class="footerContainer">
			<div class="copyright">
				<div>©
					<a target="_blank" rel="noopener" href="https://jermdavis.dev/">Jeremy Davis</a>
					2014-2025</div>
			</div>
			<div class="statiq">
				<a href="/tools">Published using Statiq</a>
				<br>
			</div>
			<ul class="feeds">
				<li>
					<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
					</svg>
				</li>
				<li>
					<a target="_blank" href="/feed.rss">RSS</a>
				</li>
				<li>
					<a target="_blank" href="/feed.atom">Atom</a>
				</li>
			</ul>
		</footer>
		<div x-cloak="" class="cookieContainer" x-data="{ hide_banner: true }" x-init="hide_banner = docCookies.hasItem('hide_banner');" x-bind:class="{ 'hidden': hide_banner, 'fixed': !hide_banner }">
			<div class="panel">
				<div class="link">
					<a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage" rel="noreferrer" target="_blank">This website uses Google Analytics, and its cookies.</a>
				</div>
				<button type="button" @click="hide_banner = true; docCookies.setItem('hide_banner', true, 'Fri, 31 Dec 9999 23:59:59 GMT', null, null, null, 'strict');" class="btn" aria-label="Dismiss">
					Understood
				</button>
			</div>
		</div>
		<script src="/vendor/Alpine/alpine.3.13.3.min.js" defer=""></script>
		<script src="/vendor/Enlighter/enlighterjs.min.js"></script>
		<script type="text/javascript">
            EnlighterJS.init('pre.code', 'code', {
            theme: 'droide',
            indent : 4,
            linehover : false,
            textOverflow: 'scroll',
            toolbarTop: '',
            toolbarBottom: ''
        });
        
		</script>
		<script defer="" src="/vendor/rp/rpbar-1.0.js"></script>
		<script defer="" src="/js/post.js"></script>
		<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JQ44ZR47YX"></script>
		<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-JQ44ZR47YX');
    
		</script>
	</body>
</html>