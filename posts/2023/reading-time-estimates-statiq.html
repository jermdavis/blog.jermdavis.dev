<!DOCTYPE html>
<html lang="en">
	<head>
		<script src="/js/theme.js"></script>
		<meta charset="utf-8">
		<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' unpkg.com www.googletagmanager.com *.google-analytics.com; img-src 'self' data: *;style-src 'self' 'unsafe-inline'">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="canonical" href="https://blog.jermdavis.dev/posts/2023/reading-time-estimates-statiq">
		<meta name="description" content="An example of adding reading time estimations to a blog generated by Statiq">
		<meta property="og:description" content="An example of adding reading time estimations to a blog generated by Statiq">
		<meta name="keywords" content="C#, Statiq">
		<meta name="author" content="Jeremy Davis">
		<meta name="copyright" content="Jeremy Davis">
		<title>Jeremy Davis - Adding reading time estimates to blog posts</title>
		<meta name="robots" content="index, follow">
		<link type="application/rss+xml" rel="alternate" title="Jeremy Davis - Sitecore, C# and web development" href="/feed.rss">
		<link type="application/atom+xml" rel="alternate" title="Jeremy Davis - Sitecore, C# and web development" href="/feed.atom">
		<meta name="application-name" content="Jeremy Davis">
		<meta name="msapplication-tooltip" content="Jeremy Davis">
		<meta name="msapplication-starturl" content="/">
		<link rel="manifest" href="/manifest.webmanifest">
		<meta property="og:type" content="article">
		<meta property="og:title" content="Adding reading time estimates to blog posts [by Jeremy Davis]">
		<meta property="og:publish_date" content="2023-12-18T00:00:00+0000">
		<meta property="article:published_time" content="2023-12-18T00:00:00+0000">
		<meta property="og:image" content="https://blog.jermdavis.dev/img/featured/reading-time-estimates-statiq-social.jpg">
		<meta property="og:image:alt" content="Logo image showing post title 'Adding reading time estimates to blog posts' and author 'Jeremy Davis'">
		<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "article",
        "headline": "Adding reading time estimates to blog posts",
        "url": "https://blog.jermdavis.dev/posts/2023/reading-time-estimates-statiq",
        "image": [
            {
                "@type": "ImageObject",
                "contentUrl": "https://blog.jermdavis.dev/img/featured/reading-time-estimates-statiq-social.jpg",
                "caption": "Logo image showing post title 'Adding reading time estimates to blog posts' and author 'Jeremy Davis'"
            }
        ],
        "datePublished": "2023-12-18T00:00:00+0000",
        "author": [{
            "@type": "Person",
            "name": "Jeremy Davis",
            "url": "https://jermdavis.dev/"
        }]
    }
    
		</script>
		<meta property="og:url" content="https://blog.jermdavis.dev/posts/2023/reading-time-estimates-statiq">
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
		<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">
		<link href="/vendor/Enlighter/enlighterjs.min.css" rel="stylesheet">
		<link href="/dist/main.css" rel="stylesheet">
		<script src="/vendor/Cookies/cookies.min.js" defer=""></script>
	</head>
	<body class="blog" x-bind:class="dk ? 'dark' : ''" id="top">
		<div id="rp-bar"></div>
		<div class="blogNavContainer" x-data="{ open: false }">
			<div class="blogNav">
				<div class="bannerContainer">
					<div class="bannerRow">
						<a href="/">
							<img class="mt-2" width="56" height="56" src="/img/Profile.jpg" alt="Jeremy Davis">
						</a>
						<div class="mx-2">
							<div class="text-3xl">Jeremy Davis</div>
							<div class="text-lg">Sitecore, C# and web development</div>
						</div>
					</div>
					<div class="nav navBurger">
						<button @click="open = true" type="button" class="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" aria-expanded="false">
							<span class="sr-only">Open menu</span>
							<svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
							</svg>
						</button>
					</div>
					<nav class="nav navItemSet">
						<a href="/posts">Posts</a>
						<a href="/tags">Tags</a>
						<a href="/about">About</a>
						<a href="/links">Useful Links</a>
						<a href="/mvp">MVP</a>
						<a href="/search">Search</a>
						<button x-cloak="" x-on:click="Clicked('2')" x-show="$store.theme == '1'">
							<img src="/img/Auto.png" width="32" height="32" alt="Auto" title="Automatic theme">
						</button>
						<button x-cloak="" x-on:click="Clicked('3')" x-show="$store.theme == '2'">
							<img src="/img/Light.png" width="32" height="32" alt="Auto" title="Light theme">
						</button>
						<button x-cloak="" x-on:click="Clicked('1')" x-show="$store.theme == '3'">
							<img src="/img/Dark.png" width="32" height="32" alt="Auto" title="Dark theme">
						</button>
					</nav>
				</div>
			</div>
			<div class="mobileContainer">
				<div style="display:none;" class="popupBox" x-show="open" x-transition="">
					<div class="popupHead">
						<div class="popupHeadInner">
							<div class="titleRow">
								<a href="/">
									<img width="56" height="56" src="/img/Profile.jpg" alt="Jeremy Davis">
								</a>
								<div class="mx-2">
									<div class="text-2xl">Jeremy Davis</div>
									<div class="text-base">Sitecore, C# and web development</div>
								</div>
							</div>
							<div class="nav menuRow">
								<button @click="open = false" type="button">
									<span class="sr-only">Close menu</span>
									
									<!-- Heroicon name: outline/x -->
									<svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
									</svg>
								</button>
							</div>
						</div>
					</div>
					<div class="nav popupItemsOuter">
						<nav class="gap-x-8">
							<a href="/posts">Posts</a>
							<a href="/tags">Tags</a>
							<a href="/about">About</a>
							<a href="/links">Useful Links</a>
							<a href="/mvp">MVP</a>
							<a href="/search">Search</a>
							<button x-cloak="" x-on:click="Clicked('2')" x-show="$store.theme == '1'">
								<img src="/img/Auto.png" width="32" height="32" alt="Auto" title="Automatic theme">
							</button>
							<button x-cloak="" x-on:click="Clicked('3')" x-show="$store.theme == '2'">
								<img src="/img/Light.png" width="32" height="32" alt="Auto" title="Light theme">
							</button>
							<button x-cloak="" x-on:click="Clicked('1')" x-show="$store.theme == '3'">
								<img src="/img/Dark.png" width="32" height="32" alt="Auto" title="Dark theme">
							</button>
						</nav>
					</div>
				</div>
			</div>
		</div>
		<header class="headerContainer" style="">
			<div class="post-heading">
				<div class="url printBanner">Article printed from:
					<tt>https://blog.jermdavis.dev/posts/2023/reading-time-estimates-statiq</tt>
				</div>
				<h1>
					Adding reading time estimates to blog posts
				</h1>
				<h2>Statiq makes this sort of extension pretty easy</h2>
				<div class="meta">Published 18 December 2023</div>
				<div class="tagList">
					<a href="/tags/c/">
						C#</a>
					<a href="/tags/statiq/">
						Statiq</a>
					<span>~3 min. read</span>
				</div>
			</div>
		</header>
		<div class="blogContainerOuter">
			<div class="blogContainerInner">
				<div class="leftCol content">
					<p>The second idea on my "little things I'd meant to add to this blog for a while" list was reading time estimates. Like
						<a href="" target="_blank" rel="noopener">the reading progress indicator from before</a>, this shouldn't be tricky, and in this case I wanted to write it down in case anyone else working with
						<a href="https://www.statiq.dev/" target="_blank" rel="noopener">Statiq</a>
						was interested in achieving something similar on their site.
						<!--more-->
					</p>
					<h2 x-data="" class="anchor">Broad approach
						<a title="click to copy url" x-on:click.prevent="copy($event.target)" href="#heading1" name="heading1">
							<img src="/img/link.png">
						</a>
						<span>url copied!</span>
					</h2>
					<p>A quick google told me that "average reading speed" is 238 words per minute. So to work out how long an article might take to read we need to count the words in the body and divide that by the reading speed.</p>
					<p>This could be implemented with some JavaScript that runs client-side when the page renders, but that means the number is only available when you're looking at the post itself. I wanted to do this in a more appropriate way for a static site generator, and have the number available on listing pages too. So I started thinking about how to implement this using Statiq's framework.</p>
					<p>The key to this is thinking about how Statiq processes documents. It makes use of a pipeline-style approach, so if we can work out the right place to insert some custom code, it can modify the generated data.</p>
					<p>There happens to be a pipeline called
						<code>Content</code>
						which does a chunk of the basic processing for loading documents to be processed. The
						<code>ProcessModules</code>
						<a href="https://github.com/statiqdev/Statiq.Web/blob/3e4b620aa8cb5d48454f323c1be25524a3ba8e21/src/Statiq.Web/Pipelines/Content.cs#L13" target="_blank" rel="noopener">property of this pipeline</a>
						contains a set of operations to read in the configured documents, filter them and generate things like excerpts.</p>
					<p>Configuring an extension to the pipelines is pretty easy. The bootstrap process that runs when Statiq starts up will find all of the
						<code>IConfigurator&lt;Bootstrapper&gt;</code>
						classes in your solution and run them as the framework initialses, so creating one of these gives an easy way to plug in a change to the default pipelines:</p>
					<pre class="code" data-enlighter-highlight="7" data-enlighter-language="csharp" style="width:100%; overflow:scroll;">public class ReadingTimeConfigurator : IConfigurator&lt;Bootstrapper&gt;
{
    public void Configure(Bootstrapper configurable)
    {
        configurable.ModifyPipeline("Content", p =&gt;
        {
            p.ProcessModules.Insert(3, new ReadingTimeModule());
        });
    }
}

					</pre>
					<p>That injects a new module at the third position in the pipeline - so it will run on any document imported, just before the
						<code>RenderContentProcessTemplates()</code>
						call in the
						<code>Content</code>
						<a href="https://github.com/statiqdev/Statiq.Web/blob/3e4b620aa8cb5d48454f323c1be25524a3ba8e21/src/Statiq.Web/Pipelines/Content.cs#L29C32-L29C32" target="_blank" rel="noopener">pipeline</a>.</p>
					<p>So what does this extra module in the pipeline need to do?</p>
					<h2 x-data="" class="anchor">Doing the calculations
						<a title="click to copy url" x-on:click.prevent="copy($event.target)" href="#heading2" name="heading2">
							<img src="/img/link.png">
						</a>
						<span>url copied!</span>
					</h2>
					<p>Well it needs to read the data for the post, extract the number of words, work out the time and save that into the metadata for the post. Given that all the work here is restricted to a single document, this is a good candidate for a
						<code>ParallelModule</code>
						- so the framework can process multiple documents in parallel if it wants to.</p>
					<p>So a simple implementation might look like this:</p>
					<pre class="code" data-enlighter-language="csharp" style="width:100%; overflow:scroll;">public class ReadingTimeModule : ParallelModule
{
    protected override async Task&lt;IEnumerable&lt;IDocument&gt;&gt; ExecuteInputAsync(IDocument input, IExecutionContext context)
    {
        if (input.Source.Extension == ".md")
        {
            var doc = new HtmlAgilityPack.HtmlDocument();

            var content = await input.GetContentStringAsync();
            doc.LoadHtml(content);

            RemoveUnwantedElements(doc);

            var text = doc.DocumentNode.InnerText;
            var count = WordCount(text);

            var ReadingSpeed = context.GetInt("ReadingSpeed");
            var readingTime = MathF.Ceiling(count / ReadingSpeed);

            return input
                .Clone(new MetadataItems { 
                    { "ReadingTime", readingTime.ToString() } 
                }).Yield();
        }

        return input.Yield();
    }
}

					</pre>
					<p>First up, it checks if the current source document was a markdown file. Some non-markdown content will get processed by the pipeline and we're not interested in that, so it can be skipped over.</p>
					<p>Then it grabs the current content for the item being processed, and parses it with the HTML Agility Pack. This gives an easy way to manipulate the markup. The code here is running after the source has been transformed into HTML, so we don't have to worry about markdown here.</p>
					<p>Now there is some stuff in the document that I didn't want to count in the estimate - the diagrams and code snippets. So the call to
						<code>RemoveUnwantedElements()</code>
						removes those from the HTML document, before calling the
						<code>InnerText</code>
						property to get just the words from the HTML. The diagrams and code snippets are
						<code>&lt;pre/&gt;</code>
						elements, so it's pretty easy to remove them:</p>
					<pre class="code" data-enlighter-language="csharp" style="width:100%; overflow:scroll;">private void RemoveUnwantedElements(HtmlDocument d)
{
    var toRemove = d.DocumentNode.SelectNodes("//pre");
    if (toRemove != null)
    {
        foreach (var element in toRemove)
        {
            element.Remove();
        }
    }
}

					</pre>
					<p>The next step is to count the words left. You could do that with
						<code>string.Split()</code>
						fairly easily, but there are some challenges with that. The key one is that you generate a lot of allocations of small strings doing that, which puts load on the Garbage Collector. Perfomance isn't too critical here really - the speed of generation isn't wildly important. But it's good practice to avoid allocations where you can. So instead, some code snagged from Stack Overflow (yes, I was feeling lazy) can count words based on whitespace:</p>
					<pre class="code" data-enlighter-language="csharp" style="width:100%; overflow:scroll;">private int WordCount(string text)
{
    int wordCount = 0, index = 0;

    while (index &lt; text.Length &amp;&amp; char.IsWhiteSpace(text[index]))
    {
        index++;
    }

    while (index &lt; text.Length)
    {
        while (index &lt; text.Length &amp;&amp; !char.IsWhiteSpace(text[index]))
        {
            index++;
        }

        wordCount++;

        while (index &lt; text.Length &amp;&amp; char.IsWhiteSpace(text[index]))
        {
            index++;
        }
    }

    return wordCount;
}

					</pre>
					<p>And with that done, the reading speed can be calculated and the data saved to the
						<code>ReadingTime</code>
						metadata property.</p>
					<h2 x-data="" class="anchor">Displaying data
						<a title="click to copy url" x-on:click.prevent="copy($event.target)" href="#heading3" name="heading3">
							<img src="/img/link.png">
						</a>
						<span>url copied!</span>
					</h2>
					<p>Since the info is stored as metadata on the document, any Razor template in the site that processes individual documents can use the metadata APIs to retrieve the data:</p>
					<pre class="code" data-enlighter-language="html" style="width:100%; overflow:scroll;">@model IDocument
&lt;span&gt;~@Model.GetString("ReadingTime") minutes&lt;/span&gt;

					</pre>
					<p>I chose to add that data at the end of the tags for each post:</p>
					<p>
						<a target="_blank" href="/img/2023/12-ExampleOfReadingTime.png">
							<img alt="An example of the reading time estimate being shown after the tags for a post on the blog" src="/img/2023/12-ExampleOfReadingTime.png">
						</a>
					</p>
					<p>Since the tags appear on both the listings and on the post pages, this data is visible in both locations too. Which is just what I wanted. Success..</p>
					<a class="gotop" href="#top">↑ Back to top</a>
					<ul class="shares">
						<li>
							<b>Feel like sharing?</b>
						</li>
						<li>⇒
							<a target="_blank" rel="nofollow noreferrer" href="https://bsky.app/intent/compose?text=Adding reading time estimates to blog posts%20https://blog.jermdavis.dev/posts/2023/reading-time-estimates-statiq">On BlueSky</a>
						</li>
						<li>⇒
							<a target="_blank" rel="nofollow noreferrer" href="https://www.linkedin.com/sharing/share-offsite/?url=https://blog.jermdavis.dev/posts/2023/reading-time-estimates-statiq">On LinkedIn</a>
						</li>
						<li>⇒
							<a target="_blank" rel="nofollow noreferrer" href="https://mastodonshare.com/?text=Adding reading time estimates to blog posts&amp;url=https://blog.jermdavis.dev/posts/2023/reading-time-estimates-statiq">On Mastodon</a>
						</li>
						<li>⇒
							<a target="_blank" rel="nofollow noreferrer" href="mailto:&amp;body=Adding reading time estimates to blog posts%20https://blog.jermdavis.dev/posts/2023/reading-time-estimates-statiq">On Email</a>
						</li>
						<li></li>
					</ul>
				</div>
				<div class="rightCol sidebar">
					<div class="barContainer">
						<section class="headingSummary">
							<h3>Post Headings</h3>
							<div>
								<ol class="headings">
									<li>
										<a href="#heading1">Broad approach
										</a>
									</li>
									<li>
										<a href="#heading2">Doing the calculations
										</a>
									</li>
									<li>
										<a href="#heading3">Displaying data
										</a>
									</li>
								</ol>
							</div>
						</section>
						<section class="mvp">
							<h3>Sitecore MVP 2015-2025</h3>
							<div>
								<a href="/mvp">
									<img class="l" src="/img/mvp/program.png" width="219" height="219" alt="2025 MVP Badge">
									<img class="d" src="/img/mvp/program_d.png" width="219" height="219" alt="2025 MVP Badge">
								</a>
							</div>
						</section>
						<section class="recentTags">
							<h3>Recent Tags</h3>
							<div>
								<a href="/tags/sitecore/">
									Sitecore
								</a>
								<a href="/tags/sugcon/">
									SUGCON
								</a>
								<a href="/tags/xm-cloud/">
									XM Cloud
								</a>
								<a href="/tags/content-hub/">
									Content Hub
								</a>
								<a href="/tags/commerce/">
									Commerce
								</a>
								<a href="/tags/performance/">
									Performance
								</a>
								<a href="/tags/visual-studio/">
									Visual Studio
								</a>
								<a href="/tags/caching/">
									Caching
								</a>
								<a href="/tags/platform-dxp/">
									Platform DXP
								</a>
								<a href="/tags/docker/">
									Docker
								</a>
							</div>
						</section>
						<section class="topTags">
							<h3>Top Tags</h3>
							<div class="list">
								<a href="/tags/sitecore/">
									Sitecore (243)</a>
								<a href="/tags/platform-dxp/">
									Platform DXP (215)</a>
								<a href="/tags/c/">
									C# (66)</a>
								<a href="/tags/powershell/">
									PowerShell (32)</a>
								<a href="/tags/installation/">
									Installation (23)</a>
								<a href="/tags/docker/">
									Docker (20)</a>
								<a href="/tags/solr/">
									Solr (19)</a>
								<a href="/tags/general/">
									General (18)</a>
								<a href="/tags/containers/">
									Containers (17)</a>
								<a href="/tags/visual-studio/">
									Visual Studio (15)</a>
							</div>
							<div class="link">
								<a href="/tags" role="button">All Tags &gt;</a>
							</div>
						</section>
						<section class="months">
							<h3>Recent Months</h3>
							<div class="list">
								<a href="/posts/2025-04">2025 - April</a>
								<a href="/posts/2025-03">2025 - March</a>
								<a href="/posts/2025-02">2025 - February</a>
								<a href="/posts/2025-01">2025 - January</a>
								<a href="/posts/2024-12">2024 - December</a>
							</div>
							<div class="link">
								<a href="/posts" role="button">All Months &gt;</a>
							</div>
						</section>
						<section class="socials">
							<h3>Socials</h3>
							<div>
								<table>
									<tbody>
										<tr>
											<td class="icon">
												<a rel="me" target="_blank" href="https://bsky.app/profile/jermdavis.dev">
													<img src="/img/bluesky.png" width="32" height="32" alt="Bluesky Logo">
												</a>
											</td>
											<td class="title">
												<a rel="me" target="_blank" href="https://bsky.app/profile/jermdavis.dev">
													Bluesky
												</a>
											</td>
										</tr>
										<tr>
											<td class="icon">
												<a rel="me" target="_blank" href="https://www.linkedin.com/in/djdavis/">
													<img src="/img/linkedin.png" width="32" height="32" alt="LinkedIn Logo">
												</a>
											</td>
											<td class="title">
												<a rel="me" target="_blank" href="https://www.linkedin.com/in/djdavis/">
													LinkedIn
												</a>
											</td>
										</tr>
										<tr>
											<td class="icon">
												<a rel="me" target="_blank" href="https://sitecorechat.slack.com/team/U73KL641G">
													<img src="/img/slack.png" width="32" height="32" alt="Sitecore Slack Logo">
												</a>
											</td>
											<td class="title">
												<a rel="me" target="_blank" href="https://sitecorechat.slack.com/team/U73KL641G">
													Sitecore Slack
												</a>
											</td>
										</tr>
										<tr>
											<td class="icon">
												<a rel="me" target="_blank" href="https://mastodon.social/@jermdavis">
													<img src="/img/mastodon.png" width="32" height="32" alt="Mastodon Logo">
												</a>
											</td>
											<td class="title">
												<a rel="me" target="_blank" href="https://mastodon.social/@jermdavis">
													Mastodon
												</a>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
		<footer class="footerContainer">
			<div class="copyright">
				<div>©
					<a target="_blank" rel="noopener" href="https://jermdavis.dev/">Jeremy Davis</a>
					2014-2025</div>
			</div>
			<div class="statiq">
				<a href="/tools">Published using Statiq</a>
				<br>
			</div>
			<ul class="feeds">
				<li>
					<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
					</svg>
				</li>
				<li>
					<a target="_blank" href="/feed.rss">RSS</a>
				</li>
				<li>
					<a target="_blank" href="/feed.atom">Atom</a>
				</li>
			</ul>
		</footer>
		<div x-cloak="" class="cookieContainer" x-data="{ hide_banner: true }" x-init="hide_banner = docCookies.hasItem('hide_banner');" x-bind:class="{ 'hidden': hide_banner, 'fixed': !hide_banner }">
			<div class="panel">
				<div class="link">
					<a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage" rel="noreferrer" target="_blank">This website uses Google Analytics, and its cookies.</a>
				</div>
				<button type="button" @click="hide_banner = true; docCookies.setItem('hide_banner', true, 'Fri, 31 Dec 9999 23:59:59 GMT', null, null, null, 'strict');" class="btn" aria-label="Dismiss">
					Understood
				</button>
			</div>
		</div>
		<script src="/vendor/Alpine/alpine.3.13.3.min.js" defer=""></script>
		<script src="/vendor/Enlighter/enlighterjs.min.js"></script>
		<script type="text/javascript">
            EnlighterJS.init('pre.code', 'code', {
            theme: 'droide',
            indent : 4,
            linehover : false,
            textOverflow: 'scroll',
            toolbarTop: '',
            toolbarBottom: ''
        });
        
		</script>
		<script defer="" src="/vendor/rp/rpbar-1.0.js"></script>
		<script defer="" src="/js/post.js"></script>
		<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JQ44ZR47YX"></script>
		<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-JQ44ZR47YX');
    
		</script>
	</body>
</html>