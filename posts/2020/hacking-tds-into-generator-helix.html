<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' unpkg.com www.googletagmanager.com *.google-analytics.com; img-src 'self' data: *;style-src 'self' 'unsafe-inline'">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="canonical" href="https://blog.jermdavis.dev/posts/2020/hacking-tds-into-generator-helix">
		<meta name="description" content="My <a href=&quot;/posts/2020/a-moment-of-confusion-with-generator-helix&quot; target=&quot;_blank&quot;>moment of confusion from a while back</a> came in the middle of a big chunk of client development work. The solution already used the <a href=&quot;https://www.npmjs.com/package/generator-helix&quot; rel=&quot;noopener&quot; target=&quot;_blank&quot;>generator-helix</a> package, but the work needed to make use of <a href=&quot;https://www.teamdevelopmentforsitecore.com/&quot; rel=&quot;noopener&quot; target=&quot;_blank&quot;>TDS</a>, rather than <a href=&quot;https://github.com/SitecoreUnicorn/Unicorn&quot; rel=&quot;noopener&quot; target=&quot;_blank&quot;>Unicorn</a>. Since I was going to be involved in creating a set of new features, and potentially a load of TDS projects, I wondered what it would take to make the generator-helix package support TDS...">
		<meta property="og:description" content="My <a href=&quot;/posts/2020/a-moment-of-confusion-with-generator-helix&quot; target=&quot;_blank&quot;>moment of confusion from a while back</a> came in the middle of a big chunk of client development work. The solution already used the <a href=&quot;https://www.npmjs.com/package/generator-helix&quot; rel=&quot;noopener&quot; target=&quot;_blank&quot;>generator-helix</a> package, but the work needed to make use of <a href=&quot;https://www.teamdevelopmentforsitecore.com/&quot; rel=&quot;noopener&quot; target=&quot;_blank&quot;>TDS</a>, rather than <a href=&quot;https://github.com/SitecoreUnicorn/Unicorn&quot; rel=&quot;noopener&quot; target=&quot;_blank&quot;>Unicorn</a>. Since I was going to be involved in creating a set of new features, and potentially a load of TDS projects, I wondered what it would take to make the generator-helix package support TDS...">
		<meta name="keywords" content="Sitecore">
		<meta name="author" content="Jeremy Davis">
		<meta name="copyright" content="Jeremy Davis">
		<title>Jeremy Davis - Hacking TDS into&nbsp;generator-helix</title>
		<meta name="robots" content="index, follow">
		<link type="application/rss+xml" rel="alternate" title="Jeremy Davis - Sitecore, C# and web development" href="/feed.rss">
		<link type="application/atom+xml" rel="alternate" title="Jeremy Davis - Sitecore, C# and web development" href="/feed.atom">
		<meta name="application-name" content="Jeremy Davis">
		<meta name="msapplication-tooltip" content="Jeremy Davis">
		<meta name="msapplication-starturl" content="/">
		<link rel="manifest" href="/manifest.webmanifest">
		<meta property="og:type" content="article">
		<meta property="og:title" content="Hacking TDS into&amp;#xA0;generator-helix [by Jeremy Davis]">
		<meta property="og:publish_date" content="2020-04-13T00:00:00+0000">
		<meta property="article:published_time" content="2020-04-13T00:00:00+0000">
		<meta property="og:image" content="https://blog.jermdavis.dev/img/featured/hacking-tds-into-generator-helix-social.jpg">
		<meta property="og:image:alt" content="Logo image showing post title 'Hacking TDS into&amp;#xA0;generator-helix' and author 'Jeremy Davis'">
		<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "article",
        "headline": "Hacking TDS into&#xA0;generator-helix",
        "url": "https://blog.jermdavis.dev/posts/2020/hacking-tds-into-generator-helix",
        "image": [
            {
                "@type": "ImageObject",
                "contentUrl": "https://blog.jermdavis.dev/img/featured/hacking-tds-into-generator-helix-social.jpg",
                "caption": "Logo image showing post title 'Hacking TDS into&#xA0;generator-helix' and author 'Jeremy Davis'"
            }
        ],
        "datePublished": "2020-04-13T00:00:00+0000",
        "author": [{
            "@type": "Person",
            "name": "Jeremy Davis",
            "url": "https://jermdavis.dev/"
        }]
    }
    
		</script>
		<meta property="og:url" content="https://blog.jermdavis.dev/posts/2020/hacking-tds-into-generator-helix">
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
		<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">
		<link href="/scss/tailwind.css" rel="stylesheet">
		<link href="/vendor/Enlighter/enlighterjs.min.css" rel="stylesheet">
		<link href="/scss/site-theme.css" rel="stylesheet">
		<script src="/vendor/Cookies/cookies.min.js" defer=""></script>
	</head>
	<body class="max-w-7xl mx-auto text-black" id="top">
		<div id="rp-bar"></div>
		<div class="relative bg-white" x-data="{ open: false }">
			
			<!-- desktop -->
			<div class="px-4 lg:px-6 bg-gray-100">
				<div class="bannerContainer flex justify-between items-center border-b-2 border-gray-100 py-6 lg:justify-start lg:space-x-10">
					<div class="flex justify-start lg:w-0 flex-1">
						<a href="/">
							<img class="mt-2" width="56" height="56" src="/img/Profile.jpg" alt="Jeremy Davis">
						</a>
						<div class="mx-2">
							<div class="text-3xl">Jeremy Davis</div>
							<div class="text-lg">Sitecore, C# and web development</div>
						</div>
					</div>
					<div class="nav -mr-2 -my-2 lg:hidden">
						<button @click="open = true" type="button" class="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" aria-expanded="false">
							<span class="sr-only">Open menu</span>
							
							<!-- Heroicon name: outline/menu -->
							<svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
							</svg>
						</button>
					</div>
					<nav class="nav hidden lg:flex space-x-10">
						<a class="text-base font-medium" href="/posts">Posts</a>
						<a class="text-base font-medium" href="/tags">Tags</a>
						<a class="text-base font-medium" href="/about">About</a>
						<a class="text-base font-medium" href="/links">Useful Links</a>
						<a class="text-base font-medium" href="/mvp">MVP</a>
					</nav>
				</div>
			</div>
			
			<!--Mobile menu, show/hide based on mobile menu state.-->
			<div class="absolute top-0 inset-x-0 p-2 transition transform origin-top-right lg:hidden z-50">
				<div style="display:none;" class="rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 bg-white divide-y-2 divide-gray-50" x-show="open" x-transition="">
					<div class="pt-5 pb-6 px-5">
						<div class="flex items-center justify-between">
							<div class="flex">
								<a href="/">
									<img class="mt-2" width="56" height="56" src="/img/Profile.jpg" alt="Jeremy Davis">
								</a>
								<div class="mx-2">
									<div class="text-2xl">Jeremy Davis</div>
									<div class="text-base">Sitecore, C# and web development</div>
								</div>
							</div>
							<div class="nav -mr-2">
								<button @click="open = false" type="button" class="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
									<span class="sr-only">Close menu</span>
									
									<!-- Heroicon name: outline/x -->
									<svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
									</svg>
								</button>
							</div>
						</div>
					</div>
					<div class="nav py-6 px-5 pt-0">
						<nav class=" gap-x-8">
							<a class="block mt-5 text-base font-medium" href="/posts">Posts</a>
							<a class="block mt-5 text-base font-medium" href="/tags">Tags</a>
							<a class="block mt-5 text-base font-medium" href="/about">About</a>
							<a class="block mt-5 text-base font-medium" href="/links">Useful Links</a>
							<a class="block mt-5 text-base font-medium" href="/mvp">MVP</a>
						</nav>
					</div>
				</div>
			</div>
		</div>
		<header class="bg-gray-300 px-4 py-1 lg:px-6 text-center" style="">
			<div class="post-heading">
				<div class="url p-1 bg-gray-100 rounded-md">Article printed from:
					<tt>https://blog.jermdavis.dev/posts/2020/hacking-tds-into-generator-helix</tt>
				</div>
				<h1 class="text-5xl mb-4 pb-1">
					Hacking TDS into&nbsp;generator-helix
				</h1>
				<div class="meta">Published 13 April 2020</div>
				<div class="flex py-1 flex-wrap">
					<a href="/tags/sitecore/" class="p-1 mr-1 mt-1 bg-gray-100 rounded-md whitespace-nowrap">
						Sitecore</a>
					<span class="p-1 mr-1 mt-1 bg-gray-100 rounded-md whitespace-nowrap">~4 min. read</span>
				</div>
			</div>
		</header>
		<div class="py-2 lg:pl-3">
			<div class="lg:flex">
				<div class="lg:flex-auto mx-3 lg:min-w-0 content">
					<p>My
						<a href="/posts/2020/a-moment-of-confusion-with-generator-helix" target="_blank">moment of confusion from a while back</a>
						came in the middle of a big chunk of client development work. The solution already used the
						<a href="https://www.npmjs.com/package/generator-helix" rel="noopener" target="_blank">generator-helix</a>
						package, but the work needed to make use of
						<a href="https://www.teamdevelopmentforsitecore.com/" rel="noopener" target="_blank">TDS</a>, rather than
						<a href="https://github.com/SitecoreUnicorn/Unicorn" rel="noopener" target="_blank">Unicorn</a>. Since I was going to be involved in creating a set of new features, and potentially a load of TDS projects, I wondered what it would take to make the generator-helix package support TDS...
						<!--more-->
					</p>
					<h2>A plan</h2>
					<p>While the existing behaviour of generator-helix offers you the choice to create Unicorn setup when you add a project to your solution, I didn't think this was the right model here. For reasons, a chunk of the C# projects had already been added, so it seemed more helpful here to be able to run a command like:</p>
					<pre class="code" data-enlighter-theme="droide-text" data-enlighter-language="text" style="width:100%; overflow:scroll;">yo helix:tds MyFeature

					</pre>
					<p>to go through the process of adding a new TDS project to a feature. Some would need multiple TDS projects, and some would need none. So this seemed to give the most flexibility.</p>
					<p>And this also seemed like a chance to bolt on some new functionality without breaking any existing behaviour...</p>
					<h2>The details</h2>
					<p>If you dig into the folder structure under
						<code>node_modules</code>
						folder for generator-helix then you'll find a
						<code>generators</code>
						folder that includes the set of "commands" it understands for generating new projects:</p>
					<p>
						<a href="/img/2020/2020-02-otb-generators.png" target="_blank">
							<img alt="OTB Generators" src="/img/2020/2020-02-otb-generators.png">
						</a>
					</p>
					<p>Out of the box you get two: The
						<code>app</code>
						folder is the generator for an overall solution. And the
						<code>add</code>
						generator is for adding a C# project to your solution. So that suggests that we could modify the behaviour of a copy of the
						<code>add</code>
						generator to get what's needed here. And there's not a great deal in there:</p>
					<p>
						<a href="/img/2020/2020-02-existing-files.png" target="_blank">
							<img alt="Existing Files" src="/img/2020/2020-02-existing-files.png">
						</a>
					</p>
					<p>The
						<code>index.js</code>
						file is the logic for most of the process, and the
						<code>Templates</code>
						folder holds the files that are going to get copied into your solution and customised to suit your needs.</p>
					<p>So I started by creating a new generator folder named
						<code>tds</code>
						and putting a copy of
						<code>index.js</code>
						into it, ready to modify.</p>
					<p>A trivial change to start with, is that it should say that it's going to generate a TDS project for us. That's done with the message in the
						<code>init()</code>
						method - which calls
						<a href="https://www.npmjs.com/package/yo" rel="noopener" target="_blank">Yeoman's</a>
						output functions:</p>
					<pre class="code" data-enlighter-theme="droide-text" data-enlighter-highlight="2" data-enlighter-language="text" style="width:100%; overflow:scroll;">init() {
    this.log(yosay('Lets add TDS to a project!'));
    this.templatedata = {};
}

					</pre>
					<p>Next up, the code needs to ask all the relevant questions to be able to generate the project we need. Some of that is the same as what's defined for C# projects – but some aspects of a TDS project are different. For starters, the question about adding Unicorn can go. That's defined in the
						<code>askForProjectSettings()</code>
						method, and we can just delete the chunk that asks about Unicorn, leaving:</p>
					<pre class="code" data-enlighter-language="jscript" style="width:100%; overflow:scroll;">askForProjectSettings() {
	let done = this.async();
	let questions = [{
		type: 'input',
		name: 'ProjectName',
		message: 'Name of your project.' + chalk.blue(' (Excluding layer prefix, name can not be empty)'),
		default: this.options.ProjectName,
		validate: util.validateProjectName
	},
	{
		type: 'input',
		name: 'sourceFolder',
		message: 'Source code folder name',
		default: 'src',
		store: true
	},
	{
		type: 'input',
		name: 'VendorPrefix',
		message: 'Enter optional vendor prefix',
		default: this.options.VendorPrefix,
		store: false
	}
	];

	this.prompt(questions).then((answers) =&gt; {
		this.settings = answers;
		done();
	});
}

					</pre>
					<p>Multiple TDS projects (in my development world, at least) with different settings may exist in a single feature. I might need a "core" project and a "master" project to keep stuff from different database. And I might need a "content" project that keeps bits of data for the feature that aren't really "developer owned", but are necessary for the code to run. So we need some extra questions, and the easiest place to fit them in seemed to be the
						<code>askForLayer()</code>
						method – though maybe if this was a less hacky approach they'd get their own method...</p>
					<p>So the code needs to ask two new questions: What database will the TDS project serialise (which is necessary to configure the TDS project file itself) and is this a project for content or for developer-owned items (which changes the naming). Those changes can get added into the flow as shown in the first highlight block below:</p>
					<pre class="code" data-enlighter-highlight="20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,51,52,60,61,62,63,64" data-enlighter-language="jscript" style="width:100%; overflow:scroll;">askForLayer() {
	const done = this.async();
	const questions = [{
		type: 'list',
		name: 'layer',
		message: 'What layer do you want to add the project too?',
		choices: [
			{
				name: 'Feature layer?',
				value: 'Feature'
			}, {
				name: 'Foundation layer?',
				value: 'Foundation'
			}, {
				name: 'Project layer?',
				value: 'Project'
			},
		]
	}, {
		type: 'list',
		name: 'database',
		message: 'What database are you serialising?',
		choices: [
			{
				name: 'Master database?',
				value: 'Master'
			},
			{
				name: 'Core database?',
				value: 'Core'
			}
		]
	}, {
		type: 'list',
		name: 'isContent',
		message: 'Is this content or developer items?' + chalk.blue(' (Content overrides database name when naming projects)'),
		choices: [
			{
				name: 'Developer?',
				value: false
			},
			{
				name: 'Content?',
				value: true
			}
		]
	}];

	this.prompt(questions).then((answers) =&gt; {
		this.layer = answers.layer;
		this.database = answers.database;
		this.isContent = answers.isContent;

		if (this.settings.VendorPrefix === '' || this.settings.VendorPrefix === undefined) {
			this.settings.LayerPrefixedProjectName = `${this.layer}.${this.settings.ProjectName}`;
		} else {
			this.settings.LayerPrefixedProjectName = `${this.settings.VendorPrefix}.${this.layer}.${this.settings.ProjectName}`;
		}

		if (this.isContent) {
			this.settings.LayerPrefixedProjectName += ".Content";
		} else {
			this.settings.LayerPrefixedProjectName += "." + this.database;
		}

		done();
	});
}

					</pre>
					<p>After the questions are asked, the answers need adding into the context data that's used for onward processing. That's done in the second and third highlights above. The two answers get saved first, and then the correct layer file name is computed based on the answers.</p>
					<p>The solution I was working with was using "<client>.<feature>.Content.scproj" for content projects and "<client>.<feature>.<database>.scproj" for the developer-owned projects.</database>
									</feature>
								</client>
							</feature>
						</client>
					</p>
					<p>So with the options captured, on to generating the right output...</p>
					<h2>Doing the generation</h2>
					<p>The meat of the hacking is in getting all the files into the right places. And the first part of that is the contents of the
						<code>Templates</code>
						folder under the TDS folder that the
						<code>index.js</code>
						file lives in. What goes here is specific to the TDS project you want to template, but I needed a
						<code>packages.config</code>
						and a
						<code>.scproj</code>
						file. The package config file was a static file - with nothing complex required:</p>
					<p>
						<a href="/img/2020/2020-02-templatefiles.png" target="_blank">
							<img alt="Template Files" src="/img/2020/2020-02-templatefiles.png">
						</a>
					</p>
					<p>But the TDS project file needs some template replacement done on it. This uses the same approach used for the C# projects. The filename includes the
						<code>_project</code>
						template string, and the contents of the file uses
						<code>&lt;%= %&gt;</code>
						blocks to fill in the relevant bits:</p>
					<pre class="code" data-enlighter-theme="droide-text" data-enlighter-highlight="6,10,12,13,14,15" data-enlighter-language="text" style="width:100%; overflow:scroll;">  &lt;PropertyGroup&gt;
    &lt;Configuration Condition=" '$(Configuration)' == '' "&gt;Debug&lt;/Configuration&gt;
    &lt;Platform Condition=" '$(Platform)' == '' "&gt;AnyCPU&lt;/Platform&gt;
    &lt;ProductVersion&gt;9.0.21022&lt;/ProductVersion&gt;
    &lt;SchemaVersion&gt;2.0&lt;/SchemaVersion&gt;
    &lt;ProjectGuid&gt;&lt;%= projectguid %&gt;&lt;/ProjectGuid&gt;
    &lt;SourceWebPhysicalPath&gt;&lt;/SourceWebPhysicalPath&gt;
    &lt;SourceWebProject&gt;&lt;/SourceWebProject&gt;
    &lt;SourceWebVirtualPath&gt;&lt;/SourceWebVirtualPath&gt;
    &lt;TargetFrameworkVersion&gt;&lt;%= target %&gt;&lt;/TargetFrameworkVersion&gt;
    &lt;CompactSitecoreItemsInProjectFile&gt;True&lt;/CompactSitecoreItemsInProjectFile&gt;
    &lt;AssemblyName&gt;&lt;%= layerprefixedprojectname %&gt;.TDS&lt;/AssemblyName&gt;
    &lt;Name&gt;&lt;%= layerprefixedprojectname %&gt;.TDS&lt;/Name&gt;
    &lt;RootNamespace&gt;&lt;%= layerprefixedprojectname %&gt;.TDS&lt;/RootNamespace&gt;
    &lt;SitecoreDatabase&gt;&lt;%= database %&gt;&lt;/SitecoreDatabase&gt;
  &lt;/PropertyGroup&gt;

					</pre>
					<p>That's similar to the C# project, but sets the Sitecore database too.</p>
					<p>The first change to the
						<code>index.js</code>
						is to make sure the database is added to the template data:</p>
					<pre class="code" data-enlighter-highlight="10" data-enlighter-language="jscript" style="width:100%; overflow:scroll;">_buildTemplateData() {
	this.templatedata.layerprefixedprojectname = this.settings.LayerPrefixedProjectName;
	this.templatedata.projectname = this.settings.ProjectName;
	this.templatedata.vendorprefix = this.settings.VendorPrefix;
	this.templatedata.projectguid = guid.v4();
	this.templatedata.layer = this.layer;
	this.templatedata.lowercasedlayer = this.layer.toLowerCase();
	this.templatedata.target = this.target;
	this.templatedata.modulegroup = this.modulegroup;
	this.templatedata.database = this.database.toLowerCase();
}

					</pre>
					<p>The code for copying project files gets simpler, as it's copying less stuff:</p>
					<pre class="code" data-enlighter-language="jscript" style="width:100%; overflow:scroll;">_copyProjectItems() {
	mkdir.sync(this.settings.ProjectPath);
	this.fs.copyTpl(
		this.templatePath('_project.scproj'),
		this.destinationPath(
			path.join(
				this.settings.ProjectPath,
				this.settings.LayerPrefixedProjectName + '.scproj')
		),
		this.templatedata);
	this.fs.copyTpl(
		this.templatePath('packages.config'),
		this.destinationPath(
			path.join(
				this.settings.ProjectPath,
				'packages.config')
		),
		this.templatedata);
}

					</pre>
					<p>And the "rename project" behaviour needs to change to understand TDS project files:</p>
					<pre class="code" data-enlighter-highlight="4,9" data-enlighter-language="jscript" style="width:100%; overflow:scroll;">_renameProjectFile() {
	fs.renameSync(
		this.destinationPath(
			path.join(this.settings.ProjectPath, '_project.scproj')
		),
		this.destinationPath(
			path.join(
				this.settings.ProjectPath,
				this.settings.LayerPrefixedProjectName + '.scproj'
			)
		)
	);
}

					</pre>
					<p>The
						<code>_copySerializationItems()</code>
						method isn't needed any more, so can be removed. And then the rest of the changes are to update the
						<code>writing()</code>
						method to suit:</p>
					<pre class="code" data-enlighter-highlight="2,7,9" data-enlighter-language="jscript" style="width:100%; overflow:scroll;">writing() {
	this.settings.ProjectPath = path.join(this.settings.sourceFolder, this.layer, this.modulegroup, this.settings.ProjectName, 'tds', this.settings.LayerPrefixedProjectName);
	this._copyProjectItems();

	const files = fs.readdirSync(this.destinationPath());
	const SolutionFile = files.find(file =&gt; file.toUpperCase().endsWith(".SLN"));
	const scriptParameters = '-Database \'' + this.database + '\' -SolutionFile \'' + this.destinationPath(SolutionFile) + '\' -Name ' + this.settings.LayerPrefixedProjectName + ' -Type ' + this.layer + ' -ProjectPath \'' + this.settings.ProjectPath + '\'' + ' -SolutionFolderName ' + this.templatedata.projectname;

	var pathToAddProjectScript = path.join(this._sourceRoot, '../add-tds.ps1');
	powershell.runAsync(pathToAddProjectScript, scriptParameters);
}

					</pre>
					<p>It needs to add in a "tds" folder into the deployment structure, the calls to deploy serialisation stuff for Unicorn are removed, and it needs to run some custom PowerShell with the relevant parameters.</p>
					<p>That PowerShell script does the hard work of getting the project added to the Solution. Microsoft don't seem to provide a good API outisde of Visual Studio extensions for working with
						<code>.sln</code>
						files, hence the need for some custom script here. The basis of this file is the
						<code>Add-Project.ps1</code>
						file in the
						<code>generator-helix</code>
						PowerShell folder. But to make deploying my hacks easier, I moved the new version inside my template folder.</p>
					<pre class="code" data-enlighter-language="powershell" style="width:100%; overflow:scroll;">param(
[Parameter(Mandatory=$true)]
[string]$Database,
[Parameter(Mandatory=$true)]
[ValidateSet("project", "feature", "foundation")]
[string]$Type,
[Parameter(Mandatory=$true)]
[string]$SolutionFile,
[Parameter(Mandatory=$true)]
[string]$Name,
[Parameter(Mandatory=$true)]
[string]$ProjectPath,
[Parameter(Mandatory=$true)]
[string]$SolutionFolderName)

. $PSScriptRoot\..\..\powershell\Add-Line.ps1
. $PSScriptRoot\..\..\powershell\Get-SolutionConfigurations.ps1
. $PSScriptRoot\..\..\powershell\Get-SolutionFolderId.ps1
. $PSScriptRoot\..\..\powershell\Get-ProjectConfigurationPlatformSection.ps1
. $PSScriptRoot\..\..\powershell\Add-BuildConfigurations.ps1

Write-Host "adding project $Name"

$configurations = Get-SolutionConfigurations -SolutionFile $SolutionFile
$solutionFolderId = Get-SolutionFolderId -SolutionFile $SolutionFile -Type $Type
$projectPath = "$ProjectPath\$name.scproj" 

$GuidSection = "GlobalSection(ProjectConfigurationPlatforms) = postSolution"
$ProjectSection = "MinimumVisualStudioVersion = 10.0.40219.1"
$NestedProjectSection = "GlobalSection(NestedProjects) = preSolution"
$projectGuid = [guid]::NewGuid();
$projectFolderGuid = Get-SolutionFolderId -SolutionFile $SolutionFile -Type $SolutionFolderName

$addProjectSection = @("Project(`{CAA73BB0-EF22-4D79-A57E-DF67B3BA9C80}`) = `$Name`, `$projectPath`, `{$projectGuid}`,"EndProject")
$addNestProjectSection = @(`t`t{$projectGuid} = $projectFolderGuid")

Add-BuildConfigurations -ProjectPath $projectPath -Configurations $configurations                
Add-Line -FileName $SolutionFile -Pattern $ProjectSection -LinesToAdd $addProjectSection
Add-Line -FileName $SolutionFile -Pattern $NestedProjectSection -LinesToAdd $addNestProjectSection

Add-Line -FileName $SolutionFile -Pattern $GuidSection -LinesToAdd (Get-ProjectConfigurationPlatformSection -Id $projectGuid -Configurations $configurations)

#Setting LastWriteTime to tell VS 2015 that solution has changed.
Set-ItemProperty -Path $SolutionFile -Name LastWriteTime -Value (get-date)

					</pre>
					<p>That adds a parameter for the database, and changes the include locations to match the fact that this file is in a different location to the previous version. The rest of the code gets the new project added to the solution.</p>
					<h2>Installing</h2>
					<p>Ideally, installing this would involve publishing an NPM package with the changes in it, so that it can be used in the same way as the original. But since I was just hacking about, I just chose to copy my changed files into the appropriate
						<code>node_modules</code>
						folder with a quick but of script. So I can put the files discussed above into a zip, and keep it with this script in my solution:</p>
					<pre class="code" data-enlighter-language="powershell" style="width:100%; overflow:scroll;">if(Test-Path "..\node_modules\generator-helix\generators") {
	Write-Host "Found local install"
	$installPath = Resolve-Path "..\..\node_modules\generator-helix\generators"
	
	Write-Host "Install to: $installPath"
	Expand-Archive "generators-tds.zip" "$installPath\tds" -Force
}

# check for global install
if(Test-Path "$env:userprofile\AppData\Roaming\npm\node_modules\generator-helix\generators\") {
	Write-Host "Found global install"
	$installPath = Resolve-Path "$env:userprofile\AppData\Roaming\npm\node_modules\generator-helix\generators\"
	
	Write-Host "Install to: $installPath"
	Expand-Archive "generators-tds.zip" "$installPath\tds" -Force
}

					</pre>
					<p>Not great - but it works – and it copes whether you did a global install of
						<code>Generator-Helix</code>
						or not...</p>
					<p>So now you can run
						<code>yo helix:tds</code>
						and get:</p>
					<p>
						<a href="/img/2020/2020-02-runtdsadd.png" target="_blank">
							<img alt="Run TDS Add" src="/img/2020/2020-02-runtdsadd.png">
						</a>
					</p>
					<p>And your solution will now magically include a TDS project:</p>
					<p>
						<a href="/img/2020/2020-02-tdsaddresult.png" target="_blank">
							<img alt="TDS Add Result" src="/img/2020/2020-02-tdsaddresult.png">
						</a>
					</p>
					<h2>Conclusions</h2>
					<p>Well, concept proved. Hacky – but good enough to save me some time...</p>
					<a class="gotop" href="#top">↑ Back to top</a>
				</div>
				<div class="sidebar lg:flex-none lg:w-64 m-0 mt-1 lg:mt-0 lg:p-1 lg:bg-gray-100">
					<div class="md:flex-row md:flex lg:flex-col">
						<section class="md:flex-2 md:flex-grow md:flex-shrink">
							<h3 class="bg-gray-300 p-2 md:border-r-2 md:border-white lg:border-r-0">Top Tags</h3>
							<div class="bg-white p-2 flex flex-wrap">
								<a href="/tags/sitecore/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									Sitecore (225)</a>
								<a href="/tags/c/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									C# (59)</a>
								<a href="/tags/powershell/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									PowerShell (31)</a>
								<a href="/tags/installation/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									Installation (23)</a>
								<a href="/tags/solr/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									Solr (19)</a>
								<a href="/tags/general/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									General (16)</a>
								<a href="/tags/docker/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									Docker (16)</a>
								<a href="/tags/containers/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									Containers (15)</a>
								<a href="/tags/ui/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									UI (15)</a>
								<a href="/tags/bug/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									Bug (12)</a>
							</div>
							<div class="bg-white mb-2 p-2">
								<a class="text-lg" href="/tags" role="button">All Tags
									<i class="fas fa-angle-double-right"></i>
								</a>
							</div>
						</section>
						<section class="md:flex-2 md:border-l-2 md:border-gray-300 lg:border-l-0 md:flex-shrink-0">
							<h3 class="bg-gray-300 p-2 md:border-r-2 md:border-white lg:border-r-0">Recent Months</h3>
							<div class="bg-white p-2">
								<div>
									<a class="text-lg" href="/posts/2024-02">2024 - February</a>
								</div>
								<div>
									<a class="text-lg" href="/posts/2024-01">2024 - January</a>
								</div>
								<div>
									<a class="text-lg" href="/posts/2023-12">2023 - December</a>
								</div>
								<div>
									<a class="text-lg" href="/posts/2023-11">2023 - November</a>
								</div>
								<div>
									<a class="text-lg" href="/posts/2023-10">2023 - October</a>
								</div>
							</div>
							<div class="bg-white mb-2 p-2">
								<a class="text-lg" href="/posts" role="button">All Posts
									<i class="fas fa-angle-double-right"></i>
								</a>
							</div>
						</section>
						<section class="md:flex-1 md:border-l-2 md:border-gray-300 lg:border-l-0 md:flex-shrink">
							<h3 class="bg-gray-300 p-2 md:border-r-2 md:border-white lg:border-r-0">Socials</h3>
							<div class="bg-white mb-2 p-2">
								<div>
									<a class="text-lg" rel="me" target="_blank" href="https://mastodon.social/@jermdavis">Mastodon</a>
								</div>
								<div>
									<a class="text-lg" rel="me" target="_blank" href="https://www.linkedin.com/in/djdavis/">LinkedIn</a>
								</div>
								<div>
									<a class="text-lg" rel="me" target="_blank" href="https://twitter.com/jermdavis">Twitter</a>
								</div>
							</div>
						</section>
						<section class="mvp md:flex-2 md:border-l-2 md:border-gray-300 lg:border-l-0 md:flex-shrink-0 lg:order-first">
							<h3 class="bg-gray-300 p-2">Sitecore MVP 2015-2024</h3>
							<div class="bg-white mb-2 p-2">
								<a href="/mvp">
									<img class="lg:mx-auto" src="/img/mvp/10yrs.png" width="219" height="219" alt="2024 MVP Badge">
								</a>
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
		<footer class="lg:flex order-1 bg-gray-100 px-4 lg:px-6 py-4">
			<div class="flex-1 lg:flex-1 text-center lg:text-left">
				<div>©
					<a target="_blank" class="font-medium" rel="noopener" href="https://jermdavis.dev/">Jeremy Davis</a>
					2014-2024</div>
			</div>
			<div class="lg:flex-1 lg:order-3 text-center lg:text-right">
				<a class="font-medium" href="/tools">Published using Statiq</a>
				<br>
			</div>
			<ul class="list-none lg:flex-1 lg:order-2 p-0 text-center lg:align-middle" style="margin:0px !important">
				<li class="inline-block">
					<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
					</svg>
				</li>
				<li class="inline-block ml-4">
					<a class="font-medium" target="_blank" href="/feed.rss">RSS</a>
				</li>
				<li class="inline-block ml-4">
					<a class="font-medium" target="_blank" href="/feed.atom">Atom</a>
				</li>
			</ul>
		</footer>
		<div class="min-h-screen bg-gray-300 py-6 flex flex-col justify-center sm:py-12" x-data="{ hide_banner: true }" x-init="hide_banner = docCookies.hasItem('hide_banner');" x-bind:class="{ 'hidden': hide_banner, 'fixed': !hide_banner }">
			<div class="border-2 border-gray-600 bg-gray-100 max-w-screen-lg mx-auto fixed bg-white inset-x-5 p-5 bottom-10 rounded-lg drop-shadow-2xl flex gap-4 flex-wrap md:flex-nowrap text-center md:text-left items-center justify-center md:justify-between">
				<div class="w-full text-lg">
					<a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage" rel="noreferrer" target="_blank">This website uses Google Analytics, and its cookies.</a>
				</div>
				<button type="button" @click="hide_banner = true; docCookies.setItem('hide_banner', true, 'Fri, 31 Dec 9999 23:59:59 GMT', null, null, null, 'strict');" class="bg-gray-400 px-5 py-2 text-white rounded-md hover:bg-gray-600 focus:outline-none" aria-label="Dismiss">Understood</button>
			</div>
		</div>
		<script src="/vendor/Alpine/alpine.3.13.3.min.js" defer=""></script>
		<script src="/vendor/Enlighter/enlighterjs.min.js"></script>
		<script type="text/javascript">
            EnlighterJS.init('pre.code', 'code', {
            theme: 'droide',
            indent : 4,
            linehover : false,
            textOverflow: 'scroll',
            toolbarTop: '',
            toolbarBottom: ''
        });
        
		</script>
		<script src="/vendor/rp/rpbar-1.0.js"></script>
		<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JQ44ZR47YX"></script>
		<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-JQ44ZR47YX');
    
		</script>
	</body>
</html>