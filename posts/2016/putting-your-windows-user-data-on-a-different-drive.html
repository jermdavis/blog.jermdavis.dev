<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' unpkg.com www.googletagmanager.com *.google-analytics.com; img-src 'self' data: *;style-src 'self' 'unsafe-inline'">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="canonical" href="https://blog.jermdavis.dev/posts/2016/putting-your-windows-user-data-on-a-different-drive">
		<meta name="description" content="The other week I mentioned I'd suffered a hard drive failure on my laptop. Other than the <a href=&quot;/posts/2016/banging-my-head-against-git-visual-studio-15-and-ssl&quot; target=&quot;_blank&quot;>git issues I wrote about last time</a>, I had another issue that seemed worth writing up: How to get all of the user data for the rebuilt install on a separate drive to the programs and operating system. If that's something you might want to do with a Windows install then read on... ">
		<meta property="og:description" content="The other week I mentioned I'd suffered a hard drive failure on my laptop. Other than the <a href=&quot;/posts/2016/banging-my-head-against-git-visual-studio-15-and-ssl&quot; target=&quot;_blank&quot;>git issues I wrote about last time</a>, I had another issue that seemed worth writing up: How to get all of the user data for the rebuilt install on a separate drive to the programs and operating system. If that's something you might want to do with a Windows install then read on... ">
		<meta name="keywords" content="Windows">
		<meta name="author" content="Jeremy Davis">
		<meta name="copyright" content="Jeremy Davis">
		<title>Jeremy Davis - Putting your Windows user data on a different&nbsp;drive</title>
		<meta name="robots" content="index, follow">
		<link type="application/rss+xml" rel="alternate" title="Jeremy Davis - Sitecore, C# and web development" href="/feed.rss">
		<link type="application/atom+xml" rel="alternate" title="Jeremy Davis - Sitecore, C# and web development" href="/feed.atom">
		<meta name="application-name" content="Jeremy Davis">
		<meta name="msapplication-tooltip" content="Jeremy Davis">
		<meta name="msapplication-starturl" content="/">
		<link rel="manifest" href="/manifest.webmanifest">
		<meta property="og:type" content="article">
		<meta property="og:title" content="Putting your Windows user data on a different&amp;#xA0;drive [by Jeremy Davis]">
		<meta property="og:publish_date" content="2016-11-14T00:00:00+0000">
		<meta property="article:published_time" content="2016-11-14T00:00:00+0000">
		<meta property="og:image" content="https://blog.jermdavis.dev/img/featured/putting-your-windows-user-data-on-a-different-drive-social.jpg">
		<meta property="og:image:alt" content="Logo image showing post title 'Putting your Windows user data on a different&amp;#xA0;drive' and author 'Jeremy Davis'">
		<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "article",
        "headline": "Putting your Windows user data on a different&#xA0;drive",
        "url": "https://blog.jermdavis.dev/posts/2016/putting-your-windows-user-data-on-a-different-drive",
        "image": [
            {
                "@type": "ImageObject",
                "contentUrl": "https://blog.jermdavis.dev/img/featured/putting-your-windows-user-data-on-a-different-drive-social.jpg",
                "caption": "Logo image showing post title 'Putting your Windows user data on a different&#xA0;drive' and author 'Jeremy Davis'"
            }
        ],
        "datePublished": "2016-11-14T00:00:00+0000",
        "author": [{
            "@type": "Person",
            "name": "Jeremy Davis",
            "url": "https://jermdavis.dev/"
        }]
    }
    
		</script>
		<meta property="og:url" content="https://blog.jermdavis.dev/posts/2016/putting-your-windows-user-data-on-a-different-drive">
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
		<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">
		<link href="/scss/tailwind.css" rel="stylesheet">
		<link href="/vendor/Enlighter/enlighterjs.min.css" rel="stylesheet">
		<link href="/scss/site-theme.css" rel="stylesheet">
		<script src="/vendor/Cookies/cookies.min.js" defer=""></script>
	</head>
	<body class="max-w-7xl mx-auto text-black" id="top">
		<div id="rp-bar"></div>
		<div class="relative bg-white" x-data="{ open: false }">
			
			<!-- desktop -->
			<div class="px-4 lg:px-6 bg-gray-100">
				<div class="bannerContainer flex justify-between items-center border-b-2 border-gray-100 py-6 lg:justify-start lg:space-x-10">
					<div class="flex justify-start lg:w-0 flex-1">
						<a href="/">
							<img class="mt-2" width="56" height="56" src="/img/Profile.jpg" alt="Jeremy Davis">
						</a>
						<div class="mx-2">
							<div class="text-3xl">Jeremy Davis</div>
							<div class="text-lg">Sitecore, C# and web development</div>
						</div>
					</div>
					<div class="nav -mr-2 -my-2 lg:hidden">
						<button @click="open = true" type="button" class="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500" aria-expanded="false">
							<span class="sr-only">Open menu</span>
							
							<!-- Heroicon name: outline/menu -->
							<svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
							</svg>
						</button>
					</div>
					<nav class="nav hidden lg:flex space-x-10">
						<a class="text-base font-medium" href="/posts">Posts</a>
						<a class="text-base font-medium" href="/tags">Tags</a>
						<a class="text-base font-medium" href="/about">About</a>
						<a class="text-base font-medium" href="/links">Useful Links</a>
						<a class="text-base font-medium" href="/mvp">MVP</a>
					</nav>
				</div>
			</div>
			
			<!--Mobile menu, show/hide based on mobile menu state.-->
			<div class="absolute top-0 inset-x-0 p-2 transition transform origin-top-right lg:hidden z-50">
				<div style="display:none;" class="rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 bg-white divide-y-2 divide-gray-50" x-show="open" x-transition="">
					<div class="pt-5 pb-6 px-5">
						<div class="flex items-center justify-between">
							<div class="flex">
								<a href="/">
									<img class="mt-2" width="56" height="56" src="/img/Profile.jpg" alt="Jeremy Davis">
								</a>
								<div class="mx-2">
									<div class="text-2xl">Jeremy Davis</div>
									<div class="text-base">Sitecore, C# and web development</div>
								</div>
							</div>
							<div class="nav -mr-2">
								<button @click="open = false" type="button" class="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
									<span class="sr-only">Close menu</span>
									
									<!-- Heroicon name: outline/x -->
									<svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
									</svg>
								</button>
							</div>
						</div>
					</div>
					<div class="nav py-6 px-5 pt-0">
						<nav class=" gap-x-8">
							<a class="block mt-5 text-base font-medium" href="/posts">Posts</a>
							<a class="block mt-5 text-base font-medium" href="/tags">Tags</a>
							<a class="block mt-5 text-base font-medium" href="/about">About</a>
							<a class="block mt-5 text-base font-medium" href="/links">Useful Links</a>
							<a class="block mt-5 text-base font-medium" href="/mvp">MVP</a>
						</nav>
					</div>
				</div>
			</div>
		</div>
		<header class="bg-gray-300 px-4 py-1 lg:px-6 text-center" style="">
			<div class="post-heading">
				<div class="url p-1 bg-gray-100 rounded-md">Article printed from:
					<tt>https://blog.jermdavis.dev/posts/2016/putting-your-windows-user-data-on-a-different-drive</tt>
				</div>
				<h1 class="text-5xl mb-4 pb-1">
					Putting your Windows user data on a different&nbsp;drive
				</h1>
				<div class="meta">Published 14 November 2016</div>
				<div class="flex py-1 flex-wrap">
					<a href="/tags/windows/" class="p-1 mr-1 mt-1 bg-gray-100 rounded-md whitespace-nowrap">
						Windows</a>
					<span class="p-1 mr-1 mt-1 bg-gray-100 rounded-md whitespace-nowrap">~4 min. read</span>
				</div>
			</div>
		</header>
		<div class="py-2 lg:pl-3">
			<div class="lg:flex">
				<div class="lg:flex-auto mx-3 lg:min-w-0 content">
					<p>The other week I mentioned I'd suffered a hard drive failure on my laptop. Other than the
						<a href="/posts/2016/banging-my-head-against-git-visual-studio-15-and-ssl" target="_blank">git issues I wrote about last time</a>, I had another issue that seemed worth writing up: How to get all of the user data for the rebuilt install on a separate drive to the programs and operating system. If that's something you might want to do with a Windows install then read on... 
						<!--more-->
					</p>
					<p>I've been using a machine running Windows Server Essentials as a home server for some time, and this manages the backup of my individual PCs. Something I realised with the recent hard disk failure was that it's rare that I'd want to restore the whole drive. The reality is that I usually want to re-install the O/S and applications to a blank drive, and then restore only my data files and some settings from backups. Hence using Windows Server Essentials to back up the entire drive is largely wasting disk space and making the backups take much longer than necessary.</p>
					<p>So I started researching how I could configure my rebuilt machine to get my user data onto a separate volume, and back up only that bit.</p>
					<h2>The simple, but incomplete approach</h2>
					<p>You can move many of your user folders about via the Windows UI. For example, if you right-click your "Documents" folder you can adjust the path via the "Location" tab:</p>
					<p>
						<a href="/img/2016/2016-11-simpleapproach.png" target="_blank">
							<img alt="Moving Documents" src="/img/2016/2016-11-simpleapproach.png">
						</a>
					</p>
					<p>While this is easy, it's not that great a solution. Firstly, it doesn't address any of the settings and data stored in any of the hidden folders that Windows keeps under your Users folder. You're moving some of the child folders of your User folder, but nowhere near all of them. Also some (poorly written) applications which make assumptions about where these folders are supposed to live won't respect the settings here, and will keep writing to the old location anyway.</p>
					<p>So what else can we do?</p>
					<h2>The more complex approach</h2>
					<p>If you're prepared to sort this out when you're in the process of installing Windows, then you can do better than the simple approach. After spending some time with Google, I came across an article describing how to physically move all of the "Users" folder, and then fool Windows into thinking it was still in the right place using directory junctions. The
						<a href="http://winaero.com/blog/move-the-users-folder-in-windows-10-windows-8-and-windows-7/" target="_blank" rel="noopener noreferrer">process I tried came from this article</a>, however I found that the precise approach described there didn't work for me. Here's what I did instead:</p>
					<ul>
						<li>Run the first stage of the Windows Installer from your CD or USB Key</li>
						<li>When you get to the "Which type of installation do you want?" question, use the "Custom Install" option. If you have a single physical drive then you'll need to create (at least) two partitions and format them. Ideally create the O/S volume first and the user data one second. If you are using multiple physical drives then just format them. Then ask Windows to install onto the one you want to be your O/S volume. That will look something like:
							<a href="/img/2016/2016-11-choosevolume.png" target="_blank">
								<img alt="Choose Volume" src="/img/2016/2016-11-choosevolume.png">
							</a>
						</li>
						<li>When you get to the first reboot of the installation, make sure your machine boots the Windows Installer media again (from CD or USB) instead of the O/S volume.</li>
						<li>When the first installer dialog reappears press Shift-F10 to bring up a command prompt.</li>
						<li>Work out the drive letters Windows has assigned for your O/S and data volumes. These will probably not be the letters you expect normally. In my case I had "E:" as the O/S volume and "D:" as my data volume. Yours may be different - if so, you will need to replace the drive letters in the following commands appropriately.</li>
						<li>Copy the Users folder from the O/S volume to the data volume. The command below will copy a collection of files and folders. It may report a small number of "could not copy" errors for some folders - that doesn't seem to be an issue.
							<code>xcopy  "E:\Users" "D:\Users" /e /i /h /k /y /c</code>
						</li>
						<li>Then remove the O/S volume's copy of this folder:
							<code>rmdir "E:Users" /s</code>
						</li>
						<li>Finally replace the folder you just deleted with a link to the folder you copied onto the data volume:
							<code>mklink /j Users "D:\Users</code>
							Those three commands should end up looking something like:
							<a href="/img/2016/2016-11-manualcommands.png" target="_blank">
								<img alt="Manual Commands" src="/img/2016/2016-11-manualcommands.png">
							</a>
						</li>
						<li>Reboot your machine, and allow the installation process to continue by booting the O/S volume.</li>
					</ul>
					<p>If all goes well, the installation should now complete (after you've answered a few more questions) and Windows should run fine. When you look at Explorer you should see something like:<br>
						<a href="/img/2016/2016-11-result.png" target="_blank">
							<img alt="Result" src="/img/2016/2016-11-result.png">
						</a>
						<br>
						Note how the Users folder here has a "this is a link" icon overlay, showing what we've done.</p>
					<p>And with that sorted out, I can now tell the Windows Server Essentials connector software to back up the
						<code>E:</code>
						drive only, so just my files and settings are copied.</p>
					<h2>One wrinkle...</h2>
					<p>I did find one scenario where the steps above don't work quite so easily. That is where the drive letter of your data volume gets changed between you creating the link above, and the installer continuing after rebooting. This seems to happen in some scenarios where the installer sorts the volumes differently to Windows itself – specifically for me it happened on a laptop which had an MSATA SSD and a SATA HDD. The installer sorted the volumes on the MSATA drive before those attached to the SATA drive, but when Windows was running it put them the other way around. If this happens to you, it will cause the installer to put up an error dialog and stop because trying to write to the fake
						<code>\Users</code>
						directory junction will fail.</p>
					<p>Should you see this error, you can use Shift-F10 to get the command prompt back, and adjust the link. Use
						<code>rmdir Users</code>
						to remove the incorrect directory junction record. Then repeat the
						<code>mklink /j</code>
						command to point a new link to the correct drive letter. Rebooting again should allow the windows installer to complete.</p>
					<p>If you're worried about getting this process right (or you just want to practice), you can test it out in a virtual machine.</p>
					<a class="gotop" href="#top">↑ Back to top</a>
				</div>
				<div class="sidebar lg:flex-none lg:w-64 m-0 mt-1 lg:mt-0 lg:p-1 lg:bg-gray-100">
					<div class="md:flex-row md:flex lg:flex-col">
						<section class="md:flex-2 md:flex-grow md:flex-shrink">
							<h3 class="bg-gray-300 p-2 md:border-r-2 md:border-white lg:border-r-0">Top Tags</h3>
							<div class="bg-white p-2 flex flex-wrap">
								<a href="/tags/sitecore/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									Sitecore (224)</a>
								<a href="/tags/c/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									C# (59)</a>
								<a href="/tags/powershell/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									PowerShell (31)</a>
								<a href="/tags/installation/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									Installation (23)</a>
								<a href="/tags/solr/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									Solr (19)</a>
								<a href="/tags/general/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									General (16)</a>
								<a href="/tags/docker/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									Docker (16)</a>
								<a href="/tags/ui/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									UI (15)</a>
								<a href="/tags/containers/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									Containers (14)</a>
								<a href="/tags/bug/" class="flex-initial text-lg p-1 mr-1 bg-gray-100 rounded-md mt-1">
									Bug (12)</a>
							</div>
							<div class="bg-white mb-2 p-2">
								<a class="text-lg" href="/tags" role="button">All Tags
									<i class="fas fa-angle-double-right"></i>
								</a>
							</div>
						</section>
						<section class="md:flex-2 md:border-l-2 md:border-gray-300 lg:border-l-0 md:flex-shrink-0">
							<h3 class="bg-gray-300 p-2 md:border-r-2 md:border-white lg:border-r-0">Recent Months</h3>
							<div class="bg-white p-2">
								<div>
									<a class="text-lg" href="/posts/2024-02">2024 - February</a>
								</div>
								<div>
									<a class="text-lg" href="/posts/2024-01">2024 - January</a>
								</div>
								<div>
									<a class="text-lg" href="/posts/2023-12">2023 - December</a>
								</div>
								<div>
									<a class="text-lg" href="/posts/2023-11">2023 - November</a>
								</div>
								<div>
									<a class="text-lg" href="/posts/2023-10">2023 - October</a>
								</div>
							</div>
							<div class="bg-white mb-2 p-2">
								<a class="text-lg" href="/posts" role="button">All Posts
									<i class="fas fa-angle-double-right"></i>
								</a>
							</div>
						</section>
						<section class="md:flex-1 md:border-l-2 md:border-gray-300 lg:border-l-0 md:flex-shrink">
							<h3 class="bg-gray-300 p-2 md:border-r-2 md:border-white lg:border-r-0">Socials</h3>
							<div class="bg-white mb-2 p-2">
								<div>
									<a class="text-lg" rel="me" target="_blank" href="https://mastodon.social/@jermdavis">Mastodon</a>
								</div>
								<div>
									<a class="text-lg" rel="me" target="_blank" href="https://www.linkedin.com/in/djdavis/">LinkedIn</a>
								</div>
								<div>
									<a class="text-lg" rel="me" target="_blank" href="https://twitter.com/jermdavis">Twitter</a>
								</div>
							</div>
						</section>
						<section class="mvp md:flex-2 md:border-l-2 md:border-gray-300 lg:border-l-0 md:flex-shrink-0 lg:order-first">
							<h3 class="bg-gray-300 p-2">Sitecore MVP 2015-2024</h3>
							<div class="bg-white mb-2 p-2">
								<a href="/mvp">
									<img class="lg:mx-auto" src="/img/mvp/10yrs.png" width="219" height="219" alt="2024 MVP Badge">
								</a>
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
		<footer class="lg:flex order-1 bg-gray-100 px-4 lg:px-6 py-4">
			<div class="flex-1 lg:flex-1 text-center lg:text-left">
				<div>©
					<a target="_blank" class="font-medium" rel="noopener" href="https://jermdavis.dev/">Jeremy Davis</a>
					2014-2024</div>
			</div>
			<div class="lg:flex-1 lg:order-3 text-center lg:text-right">
				<a class="font-medium" href="/tools">Published using Statiq</a>
				<br>
			</div>
			<ul class="list-none lg:flex-1 lg:order-2 p-0 text-center lg:align-middle" style="margin:0px !important">
				<li class="inline-block">
					<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 5c7.18 0 13 5.82 13 13M6 11a7 7 0 017 7m-6 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
					</svg>
				</li>
				<li class="inline-block ml-4">
					<a class="font-medium" target="_blank" href="/feed.rss">RSS</a>
				</li>
				<li class="inline-block ml-4">
					<a class="font-medium" target="_blank" href="/feed.atom">Atom</a>
				</li>
			</ul>
		</footer>
		<div class="min-h-screen bg-gray-300 py-6 flex flex-col justify-center sm:py-12" x-data="{ hide_banner: true }" x-init="hide_banner = docCookies.hasItem('hide_banner');" x-bind:class="{ 'hidden': hide_banner, 'fixed': !hide_banner }">
			<div class="border-2 border-gray-600 bg-gray-100 max-w-screen-lg mx-auto fixed bg-white inset-x-5 p-5 bottom-10 rounded-lg drop-shadow-2xl flex gap-4 flex-wrap md:flex-nowrap text-center md:text-left items-center justify-center md:justify-between">
				<div class="w-full text-lg">
					<a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage" rel="noreferrer" target="_blank">This website uses Google Analytics, and its cookies.</a>
				</div>
				<button type="button" @click="hide_banner = true; docCookies.setItem('hide_banner', true, 'Fri, 31 Dec 9999 23:59:59 GMT', null, null, null, 'strict');" class="bg-gray-400 px-5 py-2 text-white rounded-md hover:bg-gray-600 focus:outline-none" aria-label="Dismiss">Understood</button>
			</div>
		</div>
		<script src="/vendor/Alpine/alpine.3.13.3.min.js" defer=""></script>
		<script src="/vendor/Enlighter/enlighterjs.min.js"></script>
		<script type="text/javascript">
            EnlighterJS.init('pre.code', 'code', {
            theme: 'droide',
            indent : 4,
            linehover : false,
            textOverflow: 'scroll',
            toolbarTop: '',
            toolbarBottom: ''
        });
        
		</script>
		<script src="/vendor/rp/rpbar-1.0.js"></script>
		<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JQ44ZR47YX"></script>
		<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-JQ44ZR47YX');
    
		</script>
	</body>
</html>